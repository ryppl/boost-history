project-root ;

if --help in $(ARGV)
{
    ECHO "
Usage: bjam [options]
Options:
    --help                  This message.
    --prefix=PREFIX         Install architecture independent files here.
                            Default; C:\\Boost on Win32
                            Default; /usr/local on Unix. Linux, etc.
    --exec-prefix=EPREFIX   Install architecture dependent files here.
                            Default; PREFIX
    --libdir=DIR            Install libraries here.
                            Default; EPREFIX/lib
    --includedir=DIR        Install source headers here.
                            Default; PREFIX/include
" ;
    EXIT "" ;
}

local version-tag = [ MATCH "^([^.]+).([^.]+)" : $(BOOST_VERSION) ] ;
if $(NT) { version-tag = $(version-tag:J=) ; }
else { version-tag = $(version-tag:J=".") ; }
version-tag = $(version-tag:J=) ;

# architecture independent files
local boost-locate = [ MATCH "^--prefix=(.*)" : $(ARGV) ] ;
if $(NT) { boost-locate ?= C:\\Boost ; }
else if $(UNIX) { boost-locate ?= /usr/local ; }

# architecture dependent files
local exec-locate = [ MATCH "^--exec-prefix=(.*)" : $(ARGV) ] ;
exec-locate ?= $(boost-locate) ;

# object code libraries
local lib-locate = [ MATCH "^--libdir=(.*)" : $(ARGV) ] ;
lib-locate ?= $(exec-locate)/lib ;

# source header files
local include-locate = [ MATCH "^--includedir=(.*)" : $(ARGV) ] ;
include-locate ?= $(boost-locate)/include ;

stage $(lib-locate:D=)
    :
        # please order by name to ease maintenance
        #~ <dll>libs/date_time/build/boost_date_time
        <lib>libs/date_time/build/boost_date_time
        <lib>libs/filesystem/build/boost_filesystem
        <dll>libs/python/build/boost_python
        <lib>libs/python/build/boost_python
        <dll>libs/regex/build/boost_regex
        <lib>libs/regex/build/boost_regex
        #~ <dll>libs/signals/build/boost_signals
        <lib>libs/signals/build/boost_signals
        [ unless $(NT) :
            <dll>libs/test/build/boost_prg_exec_monitor
            <dll>libs/test/build/boost_test_exec_monitor
            <dll>libs/test/build/boost_unit_test_framework ]
        <lib>libs/test/build/boost_prg_exec_monitor
        <lib>libs/test/build/boost_test_exec_monitor
        <lib>libs/test/build/boost_unit_test_framework
        <dll>libs/thread/build/boost_thread
    :
        <locate>$(lib-locate:D)
        <architecture-subdirs>yes
        common-stage-tag
        <tag><postfix>-$(version-tag)
    :
        debug
        release
    ;

stage $(include-locate:D=)/boost-$(version-tag)
    :
        [ glob-tree $(BOOST_ROOT)/boost/compatibility/cpp_c_headers : c* ]
        [ glob-tree $(BOOST_ROOT)/boost : *.hpp *.ipp ]
    :
        <locate>$(include-locate:D)
        <tree-subdirs>$(BOOST_ROOT)
    :
    ;
