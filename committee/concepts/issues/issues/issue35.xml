<?xml version='1.0' encoding='iso-8859-1' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd" [ 
  <!ENTITY nbsp "&#160;">
] >

<issue num="35" status="WP">
  <title><code>Swappable</code> should be usable with proxy iterator references</title>
<section><sref ref="[concept.copymove]"/></section>
<submitter>LWG</submitter>
<date>29 May 2008</date>

<discussion>
  <p>The <code>Swappable</code> concept cannot currently be used with
  proxy iterator references, because they aren't necessarily
  lvalues. Moreover, its <code>swap</code> can't be applied to values
  of different types. For example, it couldn't be used for the proxy
  references coming from two different iterator types in
  the <code>swap_ranges</code> algorithm.</p>

</discussion>

<resolution>
  <p>Add a new paragraph to [concept.operator] after paragraph 23:</p>

  <pre>
<ins>auto concept HasSwap&lt;typename T, typename U&gt; {</ins>
  <ins>void swap(T, U);</ins>
<ins>}</ins>
  </pre>

  <ol start="24">
    <li><ins><i>Note</i>: describes types for which values of those types
        can be swapped.</ins></li>
  </ol>

  <p>Modify the definition of <code>Swappable</code> in
  [concept.copymove] as follows:</p>

  <pre>
auto concept Swappable&lt;typename T&gt; <ins>: HasSwap&lt;T, T&gt;</ins> { } 
  </pre>
  <ol start="11">
    <li><i>Note</i>: describes types for which values of that type
    can be swapped.</li>

    <li><ins><i>Postconditions</i>: after executing <code>swap(s,
        t)</code>, <code>t</code> has the value originally held
        by <code>s</code> and <code>s</code> has the value originally
        held by <code>t</code>.</ins></li>
  </ol>

  <p>The synopsis in [utility.concepts] will need to be updated
    accordingly.</p>

  <p>Note: the proposed resolution changed at Sophia-Antipolis, to
  create a new two-argument <code>HasSwap</code> and
  make <code>Swappable</code> refine that concept. Also, we have
  removed the reference from <code>swap</code>'s arguments; the
  appropriate kind of reference will be provided by the user
  of <code>HasSwap</code> or <code>Swappable</code>.</p>
</resolution>
</issue>
