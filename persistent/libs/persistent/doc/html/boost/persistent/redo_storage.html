<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Class template redo_storage</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="../../index.html" title="Chapter 1. Boost.Persistent">
<link rel="up" href="../../persistent/reference.html#header.boost.persistent.redo_storage_hpp" title="Header &lt;boost/persistent/redo_storage.hpp&gt;">
<link rel="prev" href="pinned_loc.html" title="Class template pinned_loc">
<link rel="next" href="object_storage_tag.html" title="Struct object_storage_tag">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="pinned_loc.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../../persistent/reference.html#header.boost.persistent.redo_storage_hpp"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="object_storage_tag.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="refentry" lang="en">
<a name="boost.persistent.redo_storage"></a><div class="titlepage"></div>
<div class="refnamediv">
<h2><span class="refentrytitle">Class template redo_storage</span></h2>
<p>boost::persistent::redo_storage &#8212; A model of AtomicStorageEngine. </p>
</div>
<h2 xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="refsynopsisdiv-title">Synopsis</h2>
<div xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="refsynopsisdiv"><pre class="synopsis"><span class="emphasis"><em>// In header: &lt;<a class="link" href="../../persistent/reference.html#header.boost.persistent.redo_storage_hpp" title="Header &lt;boost/persistent/redo_storage.hpp&gt;">boost/persistent/redo_storage.hpp</a>&gt;

</em></span><span class="bold"><strong>template</strong></span>&lt;<span class="bold"><strong>typename</strong></span> Storage, <span class="bold"><strong>bool</strong></span> Threads = <span class="bold"><strong>true</strong></span>, <span class="bold"><strong>bool</strong></span> Sync = <span class="bold"><strong>true</strong></span>&gt; 
<span class="bold"><strong>class</strong></span> <a class="link" href="redo_storage.html" title="Class template redo_storage">redo_storage</a> {
<span class="bold"><strong>public</strong></span>:
  <span class="emphasis"><em>// types</em></span>
  <span class="bold"><strong>typedef</strong></span> Storage::transaction_id <a name="boost.persistent.redo_storage.transaction_id"></a>transaction_id;
  <span class="bold"><strong>typedef</strong></span> Storage::object_id      <a name="boost.persistent.redo_storage.object_id"></a>object_id;     
  <span class="bold"><strong>typedef</strong></span> Storage::instance_id    <a name="boost.persistent.redo_storage.instance_id"></a>instance_id;   
  <span class="bold"><strong>typedef</strong></span> Storage::object_count   <a name="boost.persistent.redo_storage.object_count"></a>object_count;  
  <span class="bold"><strong>typedef</strong></span> <span class="emphasis"><em>unspecified</em></span>             <a name="boost.persistent.redo_storage.transaction"></a>transaction;   

  <span class="emphasis"><em>// <a class="link" href="redo_storage.html#boost.persistent.redo_storageconstruct-copy-destruct">construct/copy/destruct</a></em></span>
  <a class="link" href="redo_storage.html#id2565453-bb">redo_storage</a>(Storage &amp;, std::string <span class="bold"><strong>const</strong></span> &amp;, std::size_t = 20 *1024 *1024);
  <a class="link" href="redo_storage.html#id2565504-bb">~redo_storage</a>();

  <span class="emphasis"><em>// <a class="link" href="redo_storage.html#id2564982-bb">public member functions</a></em></span>
  <span class="type"><span class="emphasis"><em>unspecified</em></span></span> <a class="link" href="redo_storage.html#id2564985-bb">begin_transaction</a>() ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2564995-bb">commit_transaction</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565011-bb">apply_transaction</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565027-bb">rollback_transaction</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;) ;
  <span class="bold"><strong>template</strong></span>&lt;<span class="bold"><strong>typename</strong></span> T, <span class="bold"><strong>typename</strong></span> ResourceTag&gt; 
    <span class="type">T *</span> <a class="link" href="redo_storage.html#id2565044-bb">load_instance</a>(object_id <span class="bold"><strong>const</strong></span> &amp;, instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="bold"><strong>template</strong></span>&lt;<span class="bold"><strong>typename</strong></span> T, <span class="bold"><strong>typename</strong></span> ResourceTag&gt; 
    <span class="type">instance_id</span> <a class="link" href="redo_storage.html#id2565075-bb">save_instance</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;, T <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565115-bb">free_local_instance</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565137-bb">free_instance</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565159-bb">apply_free_instance</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type">object_id</span> <a class="link" href="redo_storage.html#id2565181-bb">allocate_object</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565197-bb">free_local_object</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565220-bb">free_object</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565242-bb">apply_free_object</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565264-bb">load_object</a>(object_id <span class="bold"><strong>const</strong></span> &amp;, transaction_id &amp;, instance_id &amp;, 
                   object_count &amp;, object_count &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565301-bb">update_object_state</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;, transaction_id, 
                           instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565335-bb">apply_object_state</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;, transaction_id, 
                          instance_id <span class="bold"><strong>const</strong></span> &amp;) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565369-bb">update_object_count</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;, object_count, 
                           object_count) ;
  <span class="type"><span class="bold"><strong>void</strong></span></span> <a class="link" href="redo_storage.html#id2565403-bb">apply_object_count</a>(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp;, object_count, 
                          object_count) ;
  <span class="type">transaction_id</span> <a class="link" href="redo_storage.html#id2565436-bb">allocate_transaction_id</a>() ;
  <span class="type">object_id</span> <a class="link" href="redo_storage.html#id2565445-bb">root_object_id</a>() ;
};</pre></div>
<div class="refsect1" lang="en">
<a name="id2886412"></a><h2>Description</h2>
<p><code class="computeroutput">redo_storage</code> is implemented by maintaining a redo log. A model of StorageEngine is used to store the objects.</p>
<p>Model of AtomicStorageEngine. Only members that are not part of this concept are documented here.</p>
<p>Template parameters: </p>
<div class="itemizedlist"><ul type="disc">
<li><p><code class="computeroutput">Storage</code> A model of StorageEngine that is used to store the objects. </p></li>
<li><p><code class="computeroutput">Threads</code> <code class="computeroutput">true</code> if this <code class="computeroutput">redo_storage</code> is accessed by multiple threads concurrently. </p></li>
<li><p><code class="computeroutput">Sync</code> <code class="computeroutput">true</code> makes the <code class="computeroutput">redo_storage</code> wait for changes to reach the physical storage device on transaction commit. <code class="computeroutput">false</code> only flushes internal buffers on commit, which may result in corrupted data in case of a system failure (but not in case the application is aborted) </p></li>
</ul></div>
<p>
</p>
<div class="refsect2" lang="en">
<a name="id2886497"></a><h3>
<a name="boost.persistent.redo_storageconstruct-copy-destruct"></a><code class="computeroutput">redo_storage</code> 
        public
       construct/copy/destruct</h3>
<div class="orderedlist"><ol type="1">
<li>
<pre class="literallayout"><a name="id2565453-bb"></a>redo_storage(Storage &amp; storage, std::string <span class="bold"><strong>const</strong></span> &amp; log_filename, 
             std::size_t max_log_size = 20 *1024 *1024);</pre>Constructs a <code class="computeroutput">redo_storage</code> object. <p>Throws: thread_resource_error, io_failure, recovery_failure 
</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><p><span class="term">Parameters:</span></p></td>
<td><div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><code class="computeroutput">log_filename</code></span></p></td>
<td><p>Filename of the redo log </p></td>
</tr>
<tr>
<td><p><span class="term"><code class="computeroutput">max_log_size</code></span></p></td>
<td><p>Maximum size of the redo log, in bytes. When max_log_size is reached a new redo log is started and the old one is removed as soon as possible. Note that this is dependent on transactions that are still running, so the actual disk space used for log files may exceed max_log_size. </p></td>
</tr>
<tr>
<td><p><span class="term"><code class="computeroutput">storage</code></span></p></td>
<td><p>The <code class="computeroutput">StorageEngine</code> that is used to store the objects </p></td>
</tr>
</tbody>
</table></div></td>
</tr></tbody>
</table></div>
</li>
<li>
<pre class="literallayout"><a name="id2565504-bb"></a>~redo_storage();</pre>Throws: Nothing. </li>
</ol></div>
</div>
<div class="refsect2" lang="en">
<a name="id2886623"></a><h3>
<a name="id2564982-bb"></a><code class="computeroutput">redo_storage</code> public member functions</h3>
<div class="orderedlist"><ol type="1">
<li><pre class="literallayout"><span class="type"><span class="emphasis"><em>unspecified</em></span></span> <a name="id2564985-bb"></a>begin_transaction() ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2564995-bb"></a>commit_transaction(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565011-bb"></a>apply_transaction(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565027-bb"></a>rollback_transaction(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx) ;</pre></li>
<li><pre class="literallayout"><span class="bold"><strong>template</strong></span>&lt;<span class="bold"><strong>typename</strong></span> T, <span class="bold"><strong>typename</strong></span> ResourceTag&gt; 
  <span class="type">T *</span> <a name="id2565044-bb"></a>load_instance(object_id <span class="bold"><strong>const</strong></span> &amp; oid, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="bold"><strong>template</strong></span>&lt;<span class="bold"><strong>typename</strong></span> T, <span class="bold"><strong>typename</strong></span> ResourceTag&gt; 
  <span class="type">instance_id</span> <a name="id2565075-bb"></a>save_instance(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid, 
                            T <span class="bold"><strong>const</strong></span> &amp; o) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565115-bb"></a>free_local_instance(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565137-bb"></a>free_instance(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565159-bb"></a>apply_free_instance(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="type">object_id</span> <a name="id2565181-bb"></a>allocate_object(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565197-bb"></a>free_local_object(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565220-bb"></a>free_object(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565242-bb"></a>apply_free_object(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565264-bb"></a>load_object(object_id <span class="bold"><strong>const</strong></span> &amp; oid, transaction_id &amp; tid, 
                 instance_id &amp; iid, object_count &amp; strong, 
                 object_count &amp; weak) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565301-bb"></a>update_object_state(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid, 
                         transaction_id tid, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565335-bb"></a>apply_object_state(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp; oid, 
                        transaction_id tid, instance_id <span class="bold"><strong>const</strong></span> &amp; iid) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565369-bb"></a>update_object_count(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp; tx, object_id <span class="bold"><strong>const</strong></span> &amp; oid, 
                         object_count strong, object_count weak) ;</pre></li>
<li><pre class="literallayout"><span class="type"><span class="bold"><strong>void</strong></span></span> <a name="id2565403-bb"></a>apply_object_count(<a class="link" href="redo_storage.html#boost.persistent.redo_storage.transaction">transaction</a> &amp;, object_id <span class="bold"><strong>const</strong></span> &amp; oid, 
                        object_count strong, object_count weak) ;</pre></li>
<li><pre class="literallayout"><span class="type">transaction_id</span> <a name="id2565436-bb"></a>allocate_transaction_id() ;</pre></li>
<li><pre class="literallayout"><span class="type">object_id</span> <a name="id2565445-bb"></a>root_object_id() ;</pre></li>
</ol></div>
</div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright © 2009 Stefan Strasser<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="pinned_loc.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../../persistent/reference.html#header.boost.persistent.redo_storage_hpp"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="object_storage_tag.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
