<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Configuring Boost.Persistent</title>
<link rel="stylesheet" href="../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="../index.html" title="Chapter 1. Boost.Persistent">
<link rel="up" href="../index.html" title="Chapter 1. Boost.Persistent">
<link rel="prev" href="advanced.html" title="Advanced topics">
<link rel="next" href="extending.html" title="Extending Boost.Persistent">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="advanced.html"><img src="../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="extending.html"><img src="../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="persistent.configuring"></a><a class="link" href="configuring.html" title="Configuring Boost.Persistent"> Configuring Boost.Persistent</a>
</h2></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="configuring.html#persistent.configuring.intro"> Introduction</a></span></dt>
<dt><span class="section"><a href="configuring.html#persistent.configuring.defaultconf"> Changing the default
      configuration</a></span></dt>
<dt><span class="section"><a href="configuring.html#persistent.configuring.defaulttrans"> Configuring the
      default transaction manager</a></span></dt>
<dt><span class="section"><a href="configuring.html#persistent.configuring.defaultres"> Configuring the default
      resource manager</a></span></dt>
</dl></div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="persistent.configuring.intro"></a><a class="link" href="configuring.html#persistent.configuring.intro" title="Introduction"> Introduction</a>
</h3></div></div></div>
<p>
        The two classes used in the previous sections, <code class="computeroutput"><a class="link" href="../boost/persistent/savepoints_session.html" title="Class savepoints_session">savepoints_session</a></code>
        and <code class="computeroutput"><a class="link" href="../boost/persistent/transactional_session.html" title="Class transactional_session">transactional_session</a></code>
        can be used to open a Boost.Persistent session with a single line of code.
      </p>
<p>
        However, those classes are only shortcuts to create a session of the default
        configuration.
      </p>
<pre class="programlisting"><span class="identifier">transactional_session</span> <span class="identifier">session</span><span class="special">(</span><span class="string">"mydb"</span><span class="special">);</span>
</pre>
<p>
        is equivalent to
      </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">mapped_file_block</span> <span class="identifier">block_type</span><span class="special">;</span>
<span class="identifier">block_type</span> <span class="identifier">block</span><span class="special">(</span><span class="string">"mydb.db"</span><span class="special">);</span>

<span class="keyword">typedef</span> <span class="identifier">block_storage</span><span class="special">&lt;</span><span class="identifier">block_type</span><span class="special">&gt;</span> <span class="identifier">storage_type</span><span class="special">;</span>
<span class="identifier">storage_type</span> <span class="identifier">storage</span><span class="special">(</span><span class="identifier">block</span><span class="special">);</span>

<span class="keyword">typedef</span> <span class="identifier">redo_storage</span><span class="special">&lt;</span><span class="identifier">storage_type</span><span class="special">&gt;</span> <span class="identifier">atomic_storage_type</span><span class="special">;</span>
<span class="identifier">atomic_storage_type</span> <span class="identifier">atomic_storage</span><span class="special">(</span><span class="string">"mydb.log"</span><span class="special">,</span><span class="identifier">storage</span><span class="special">);</span>

<span class="keyword">typedef</span> <span class="identifier">multiversion_object_resource</span><span class="special">&lt;</span><span class="identifier">atomic_storage_type</span><span class="special">&gt;</span> <span class="identifier">resource_manager_type</span><span class="special">;</span>
<span class="identifier">resource_manager_type</span> <span class="identifier">resource_manager</span><span class="special">(</span><span class="identifier">atomic_storage</span><span class="special">);</span>

<span class="keyword">typedef</span> <span class="identifier">basic_transaction_manager</span><span class="special">&lt;</span><span class="identifier">resource_manager_type</span><span class="special">&gt;</span> <span class="identifier">transaction_manager_type</span><span class="special">;</span>
<span class="identifier">transaction_manager_type</span> <span class="identifier">transaction_manager</span><span class="special">(</span><span class="identifier">resource_manager</span><span class="special">);</span>
</pre>
<p>
        Most of these types have configuration options, and can be exchanged by other
        types implementing the same <span class="emphasis"><em>concept</em></span>.
      </p>
<p>
        This section will discuss the configuration options, while <a class="link" href="extending.html" title="Extending Boost.Persistent">Extending
        Boost.Persistent</a> will discuss the implementation of types that replace
        existing ones.
      </p>
<p>
        The ultimate goal of the code snippet above is to construct a <span class="emphasis"><em>transaction
        manager</em></span>, which is used by <code class="computeroutput"><a class="link" href="../boost/persistent/basic_transaction.html" title="Class template basic_transaction">transaction</a></code>,
        the <span class="emphasis"><em>locators</em></span> and other classes to start <span class="emphasis"><em>transactions</em></span>
        and access <span class="emphasis"><em>persistent objects</em></span>.
      </p>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="persistent.configuring.defaultconf"></a><a class="link" href="configuring.html#persistent.configuring.defaultconf" title="Changing the default configuration"> Changing the default
      configuration</a>
</h3></div></div></div>
<p>
        As is shown above, the <span class="emphasis"><em>transaction manager</em></span> defines the
        configuration of a session.
      </p>
<p>
        The type of the <span class="emphasis"><em>transaction manager</em></span> must be known to
        all types accessing <span class="emphasis"><em>persistent objects</em></span>, including the
        <span class="emphasis"><em>locators</em></span>. For example, <code class="computeroutput"><a class="link" href="../boost/persistent/loc.html" title="Class template loc">loc</a></code>
        is an alias for <code class="computeroutput"><a class="link" href="../boost/persistent/basic_loc.html" title="Class template basic_loc">basic_loc</a></code>
        using the default <span class="emphasis"><em>transaction manager</em></span>.
      </p>
<p>
        The default <span class="emphasis"><em>transaction manager</em></span> can be changed by defining
        the macro BOOST_PERSISTENT_CONFIGURATION.
      </p>
<p>
        Example:
      </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="special">...</span> <span class="identifier">my_transaction_manager_type</span><span class="special">;</span>

<span class="preprocessor">#define</span> <span class="identifier">BOOST_PERSISTENT_CONFIGURATION</span> <span class="identifier">my_transaction_manager_type</span><span class="special">;</span>

<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">persistent</span><span class="special">/</span><span class="identifier">loc</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="identifier">loc</span><span class="special">&lt;</span><span class="identifier">pers_type</span><span class="special">&gt;</span> <span class="identifier">l</span><span class="special">(</span><span class="keyword">new</span> <span class="identifier">pers_type</span><span class="special">);</span> <span class="comment">// using my_transaction_manager_type
</span></pre>
<p>
        If a piece of code should support different <span class="emphasis"><em>transaction managers</em></span>,
        <span class="emphasis"><em>basic_loc</em></span> must be used instead of <span class="emphasis"><em>loc</em></span>,
        <span class="emphasis"><em>basic_transaction</em></span> instead of <span class="emphasis"><em>transaction</em></span>,
        etc.
      </p>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="persistent.configuring.defaulttrans"></a><a class="link" href="configuring.html#persistent.configuring.defaulttrans" title="Configuring the default transaction manager"> Configuring the
      default transaction manager</a>
</h3></div></div></div>
<p>
        The configuration of <code class="computeroutput"><a class="link" href="../boost/persistent/basic_transaction_manager.html" title="Class template basic_transaction_manager">basic_transaction_manager</a></code>
        consists mostly of one or more <span class="emphasis"><em>resource managers</em></span>, offering
        services:
      </p>
<p>
        <span class="inlinemediaobject"><img src="../transaction_manager.jpg" alt="transaction_manager"></span>
      </p>
<p>
        If only one <span class="emphasis"><em>resource manager</em></span> is used, its type can be
        passed to basic_transaction_manager's template parameter <span class="emphasis"><em>Resources</em></span>
        and the <span class="emphasis"><em>resource manager</em></span> object to its constructor:
      </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="special">...</span> <span class="identifier">resource_type</span><span class="special">;</span>
<span class="identifier">resource_type</span> <span class="identifier">resource</span><span class="special">;</span>
<span class="keyword">typedef</span> <span class="identifier">basic_transaction_manager</span><span class="special">&lt;</span><span class="identifier">resource_type</span><span class="special">&gt;</span> <span class="identifier">transaction_manager_type</span><span class="special">;</span>
<span class="identifier">transaction_manager_type</span> <span class="identifier">transaction_manager</span><span class="special">(</span><span class="identifier">resource</span><span class="special">);</span>
</pre>
<p>
        To support more than one <span class="emphasis"><em>resource manager</em></span>, a Boost.MPL
        <span class="emphasis"><em>Sequence</em></span> can be passed to <span class="emphasis"><em>Resources</em></span>,
        and a Boost.Fusion <span class="emphasis"><em>Sequence</em></span> to the <span class="emphasis"><em>basic_transaction_manager</em></span>
        constructor:
      </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="special">...</span> <span class="identifier">resource1_type</span><span class="special">;</span>
<span class="identifier">resource1_type</span> <span class="identifier">resource1</span><span class="special">;</span>
<span class="keyword">typedef</span> <span class="special">...</span> <span class="identifier">resource2_type</span><span class="special">;</span>
<span class="identifier">resource2_type</span> <span class="identifier">resource2</span><span class="special">;</span>
<span class="keyword">typedef</span> <span class="identifier">mpl</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">resource1_type</span><span class="special">,</span><span class="identifier">resource2_type</span><span class="special">&gt;</span> <span class="identifier">resource_types</span><span class="special">;</span>
<span class="identifier">fusion</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">resource1_type</span> <span class="special">&amp;,</span><span class="identifier">resource2_type</span> <span class="special">&amp;&gt;</span> <span class="identifier">resources</span><span class="special">(</span><span class="identifier">resource1</span><span class="special">,</span><span class="identifier">resource2</span><span class="special">);</span>

<span class="keyword">typedef</span> <span class="identifier">basic_transaction_manager</span><span class="special">&lt;</span><span class="identifier">resource_types</span><span class="special">&gt;</span> <span class="identifier">transaction_manager_type</span><span class="special">;</span>
<span class="identifier">transaction_manager_type</span> <span class="identifier">transaction_manager</span><span class="special">(</span><span class="identifier">resources</span><span class="special">);</span>
</pre>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/html/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
<p>
          At this point Boost.Persistent only comes with one <span class="emphasis"><em>resource manager</em></span>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>.
          See <a class="link" href="future.html" title="Future development">Future development</a> to see
          that this is intended for.
        </p>
<p>
          However, <span class="emphasis"><em>multiversion_object_resource</em></span> and types used
          by it also have template parameters for configuration which change the
          type of the <span class="emphasis"><em>resource manager</em></span>. The new type must be
          registered correctly with the <span class="emphasis"><em>transaction manager</em></span>.
        </p>
</td></tr>
</table></div>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="persistent.configuring.defaultres"></a><a class="link" href="configuring.html#persistent.configuring.defaultres" title="Configuring the default resource manager"> Configuring the default
      resource manager</a>
</h3></div></div></div>
<p>
        The following graph shows the default configuration of Boost.Persistent:
      </p>
<p>
        <span class="inlinemediaobject"><img src="../configuration.jpg" alt="configuration"></span>
      </p>
<p>
        Static configuration options:
      </p>
<div class="itemizedlist"><ul type="disc">
<li>
<span class="emphasis"><em>Threads</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/basic_transaction_manager.html" title="Class template basic_transaction_manager">basic_transaction_manager</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/redo_storage.html" title="Class template redo_storage">redo_storage</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/block_storage.html" title="Class template block_storage">block_storage</a></code>:
          <span class="emphasis"><em>true</em></span> by default. <span class="emphasis"><em>false</em></span> increases
          performance, but concurrent access to <span class="emphasis"><em>persistent objects</em></span>
          results in undefined behaviour.
        </li>
<li>
<span class="emphasis"><em>TThreads</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/basic_transaction_manager.html" title="Class template basic_transaction_manager">basic_transaction_manager</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>:
          <span class="emphasis"><em>true</em></span> by default. <span class="emphasis"><em>false</em></span> increases
          performance. If <span class="emphasis"><em>Threads</em></span> is <span class="emphasis"><em>true</em></span>
          but <span class="emphasis"><em>TThreads</em></span> is <span class="emphasis"><em>false</em></span>, <span class="emphasis"><em>persistent
          objects</em></span> can be accessed concurrently using <span class="emphasis"><em>concurrent
          transaction</em></span>, but accessing the same <span class="emphasis"><em>persistent objects</em></span>
          by multiple threads from within the same <span class="emphasis"><em>transaction</em></span>
          results in undefined behaviour.
        </li>
<li>
<span class="emphasis"><em>Sync</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/redo_storage.html" title="Class template redo_storage">redo_storage</a></code>:
          <span class="emphasis"><em>true</em></span> by default. Indicates if the transaction log
          maintained by <span class="emphasis"><em>redo_storage</em></span> is synchronized with the
          physical storage device on <span class="emphasis"><em>transaction commit</em></span>. <span class="emphasis"><em>true</em></span>
          is safe in case of an application crash and in case of a system failure.
          <span class="emphasis"><em>false</em></span> is only safe in case of an application crash.
          <span class="emphasis"><em>false</em></span> increases performance.
        </li>
<li>
<span class="emphasis"><em>AStorage</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>:
          Instead of <code class="computeroutput"><a class="link" href="../boost/persistent/redo_storage.html" title="Class template redo_storage">redo_storage</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/null_atomic_storage.html" title="Class template null_atomic_storage">null_atomic_storage</a></code>
          can be used as the storage engine used by <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>.
          <code class="computeroutput"><a class="link" href="../boost/persistent/null_atomic_storage.html" title="Class template null_atomic_storage">null_atomic_storage</a></code>
          increases performance a lot, but is safe neither in the case of an application
          crash nor in the case of a system failure. Only if the application is shut
          down properly the saved state can be read on restart.
        </li>
<li>
<span class="emphasis"><em>DataBlock</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/block_storage.html" title="Class template block_storage">block_storage</a></code>:
          Instead of <code class="computeroutput"><a class="link" href="../boost/persistent/mapped_file_block.html" title="Class mapped_file_block">mapped_file_block</a></code>,
          <code class="computeroutput"><a class="link" href="../boost/persistent/streambuf_block.html" title="Class streambuf_block">streambuf_block</a></code>
          can be used as the data block <code class="computeroutput"><a class="link" href="../boost/persistent/block_storage.html" title="Class template block_storage">block_storage</a></code>
          uses to save its data. <code class="computeroutput"><a class="link" href="../boost/persistent/streambuf_block.html" title="Class streambuf_block">streambuf_block</a></code>
          can use any <span class="emphasis"><em>std::streambuf</em></span> to store its data, including
          <span class="emphasis"><em>std::filebuf</em></span> to store the data in a regular file or
          <span class="emphasis"><em>std::stringbuf</em></span> to store it in memory. <span class="emphasis"><em>Sync</em></span>
          of <code class="computeroutput"><a class="link" href="../boost/persistent/redo_storage.html" title="Class template redo_storage">redo_storage</a></code>
          must be <span class="emphasis"><em>false</em></span> in case <code class="computeroutput"><a class="link" href="../boost/persistent/streambuf_block.html" title="Class streambuf_block">streambuf_block</a></code>
          is used, as <span class="emphasis"><em>std::streambufs</em></span> don't support synchronizing
          with physical storage.
        </li>
<li>
<span class="emphasis"><em>Tag</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>:
          The tag that is used to identify the <span class="emphasis"><em>resource manager</em></span>.
          If two or more <span class="emphasis"><em>resource managers</em></span> are used, they can't
          use both the default <span class="emphasis"><em>default_tag</em></span>.
        </li>
</ul></div>
<p>
        Runtime configuration options:
      </p>
<div class="itemizedlist"><ul type="disc">
<li>
<span class="emphasis"><em>max_cache_size</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/multiversion_object_res_id2563531.html" title="Class template multiversion_object_resource">multiversion_object_resource</a></code>:
          Maximum numbers of objects that are internally cached. This is independent
          of the size of each individual object, so if large objects are used this
          number should be set accordingly.
        </li>
<li>
<span class="emphasis"><em>max_log_size</em></span> of <code class="computeroutput"><a class="link" href="../boost/persistent/redo_storage.html" title="Class template redo_storage">redo_storage</a></code>:
          Maximum size of a log file, in bytes. When <span class="emphasis"><em>max_log_size</em></span>
          is reached a new log is started and the old one is removed as soon as possible.
        </li>
</ul></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright © 2009 Stefan Strasser<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="advanced.html"><img src="../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="extending.html"><img src="../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
