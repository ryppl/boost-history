<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title> Tutorial 1</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.68.1">
<link rel="start" href="../../index.html" title="Chapter 1. Boost.Reflection 1.0">
<link rel="up" href="../tutorials.html" title="Tutorials">
<link rel="prev" href="../tutorials.html" title="Tutorials">
<link rel="next" href="tutorial02.html" title=" Tutorial 2">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../boost.png"></td>
<td align="center"><a href="../../../../index.htm">Home</a></td>
<td align="center"><a href="../../libraries.html">Libraries</a></td>
<td align="center"><a href="../../../../people/people.htm">People</a></td>
<td align="center"><a href="../../../../more/faq.htm">FAQ</a></td>
<td align="center"><a href="../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../tutorials.html"><img src="../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorials.html"><img src="../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="tutorial02.html"><img src="../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="boost_reflection.tutorials.tutorial01"></a><a href="tutorial01.html" title=" Tutorial 1"> Tutorial 1</a></h3></div></div></div>
<p>
        Let's create a car class. This will later be our reflected class.
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="keyword">class</span> <span class="identifier">car</span> <span class="special">{</span>
<span class="keyword">private</span><span class="special">:</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">name_</span><span class="special">;</span>
  <span class="keyword">bool</span> <span class="identifier">started_</span><span class="special">;</span>

<span class="keyword">public</span><span class="special">:</span>
  <span class="identifier">car</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">car_name</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">name_</span><span class="special">(</span><span class="identifier">car_name</span><span class="special">),</span> <span class="identifier">started_</span><span class="special">(</span><span class="keyword">false</span><span class="special">)</span> <span class="special">{}</span>

  <span class="keyword">bool</span> <span class="identifier">start</span><span class="special">(</span><span class="keyword">void</span><span class="special">)</span> <span class="special">{</span> 
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">name_</span> <span class="special">&lt;&lt;</span> <span class="string">" started."</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span> 
    <span class="identifier">started_</span> <span class="special">=</span> <span class="keyword">true</span><span class="special">;</span>
    <span class="keyword">return</span> <span class="keyword">true</span><span class="special">;</span>
  <span class="special">}</span>

  <span class="keyword">bool</span> <span class="identifier">turn</span><span class="special">(</span><span class="keyword">float</span> <span class="identifier">angle</span><span class="special">)</span>
  <span class="special">{</span>
    <span class="keyword">if</span><span class="special">(</span><span class="identifier">started_</span><span class="special">)</span> <span class="special">{</span>
      <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Turning "</span> <span class="special">&lt;&lt;</span> <span class="identifier">name_</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span><span class="special">&lt;&lt;</span> <span class="identifier">angle</span> <span class="special">&lt;&lt;</span> <span class="string">" degrees."</span> 
                <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
      <span class="keyword">return</span> <span class="keyword">true</span><span class="special">;</span>
    <span class="special">}</span> <span class="keyword">else</span> <span class="special">{</span>
      <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Cannot turn before starting the engine of "</span> 
                <span class="special">&lt;&lt;</span> <span class="identifier">name_</span> <span class="special">&lt;&lt;</span> <span class="string">"."</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
      <span class="keyword">return</span> <span class="keyword">false</span><span class="special">;</span>
    <span class="special">}</span>
  <span class="special">}</span>
  <span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">car</span><span class="special">(</span><span class="keyword">void</span><span class="special">)</span> <span class="special">{}</span>
<span class="special">};</span> 
</pre>
<p>
      </p>
<p>
        It has methods for starting the engine and turning the car. Note that you
        can't turn before starting the engine (it has state).
      </p>
<p>
        Now we will create the reflection for this class. Let's note that we don't
        have to add any MACRO to the original header file.
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">boost</span><span class="special">::</span><span class="identifier">extension</span><span class="special">::</span><span class="identifier">reflection</span><span class="special">&lt;</span><span class="identifier">car</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">car_reflection</span><span class="special">(</span><span class="string">"A Car!"</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        With this instruction we create a reflection. The template parameters describe
        the reflected class and the type that we will use to store additional data
        (the Info class). The parameter of the constructor is an instance of this
        class, in this case we use it to store a short description.
      </p>
<p>
        Now that we have created the reflection (i.e. the place where we will store
        the meta-information of the class) we can start to add the methods.
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">car_reflection</span><span class="special">.</span><span class="identifier">add</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;(&amp;</span><span class="identifier">car</span><span class="special">::</span><span class="identifier">start</span><span class="special">,</span> <span class="number">3</span><span class="special">);</span>
<span class="identifier">car_reflection</span><span class="special">.</span><span class="identifier">add</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">,</span> <span class="keyword">float</span><span class="special">,</span> 
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(&amp;</span><span class="identifier">car</span><span class="special">::</span><span class="identifier">turn</span><span class="special">,</span> <span class="string">"turn"</span><span class="special">,</span> <span class="string">"turn_angle"</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        We are adding here the two methods. First we add the start method. The template
        parameters indicate that we will identify this method by an int (3 in this
        case) and that the return type is bool. We also have to provide a pointer
        to the method.
      </p>
<p>
        Then we add the second method. It's described by an string ("turn"
        in this case), and it returns a bool. Also we say that it receives a float
        and it's described by a string ("turn_angle").
      </p>
<p>
        Having the methods stored in our reflection we can now see how to call them.
        We have two ways.
      </p>
<p>
        First, let's define one instance to use the reflection on:
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">car</span> <span class="identifier">porsche_911</span><span class="special">(</span><span class="string">"Porsche 911"</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        The simplest one is the following:
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">car_reflection</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;(&amp;</span><span class="identifier">porsche_911</span><span class="special">,</span> <span class="number">3</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        We just invoke the "call" method of the reflection. We provide
        the instance and the description of the method. Let's see how to use it when
        the method has parameters:
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">car_reflection</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">,</span> 
  <span class="keyword">float</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(&amp;</span><span class="identifier">porsche_911</span><span class="special">,</span> <span class="string">"turn"</span><span class="special">,</span> <span class="special">.</span><span class="number">5f</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        Now we have to define with template arguments the way that we describe the
        method and the parameters. Also we have to provide the instance, the method
        description and the value of the parameter.
      </p>
<p>
        Of course, this approach is a bit limited, because we have to provide a lot
        of information to call the actual method.
      </p>
<p>
        Using meta-level programming we are trying to achieve a flexibility that
        could be mined with that requirements. Simply we don't have such information
        most of the time. Because of that we implemented a second way to call methods.
      </p>
<p>
        First we define a parameter_map. We will store there the possible parameters.
        Note that we're defining an unneeded parameter. It'll be simply ignored.
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">boost</span><span class="special">::</span><span class="identifier">extension</span><span class="special">::</span><span class="identifier">parameter_map</span> <span class="identifier">pm</span><span class="special">;</span>
<span class="identifier">pm</span><span class="special">.</span><span class="identifier">add</span><span class="special">&lt;</span><span class="keyword">float</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(.</span><span class="number">15f</span><span class="special">,</span> <span class="string">"turn_angle"</span><span class="special">);</span>
<span class="identifier">pm</span><span class="special">.</span><span class="identifier">add</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(</span><span class="number">50</span><span class="special">,</span> <span class="string">"acceleration"</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        Then we use this parameter_map to call the method and provide the needed
        parameters. In this way we just have to know the method ID.
      </p>
<p>
        For example in the case of turn we could now call it with:
      </p>
<p>
        
</p>
<pre class="programlisting">
<span class="identifier">car_reflection</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(</span><span class="string">"turn"</span><span class="special">,</span> <span class="special">&amp;</span><span class="identifier">porsche_911</span><span class="special">,</span> <span class="identifier">pm</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        This are the basic functionalities of the library that allows the programmer
        to generate the meta-class layer and use them dynamically at run-time.
      </p>
</div>
<table width="100%"><tr>
<td align="left"></td>
<td align="right"><small>Copyright © 2007 Mariano G. Consoni, Jeremy Pack</small></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../tutorials.html"><img src="../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorials.html"><img src="../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="tutorial02.html"><img src="../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
