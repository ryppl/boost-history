<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Porting from Phoenix 2.0</title>
<link rel="stylesheet" href="../../../../../../doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../../index.html" title="Chapter&#160;1.&#160;Phoenix 3.0">
<link rel="up" href="../advanced_topics.html" title="Advanced Topics">
<link rel="prev" href="../advanced_topics.html" title="Advanced Topics">
<link rel="next" href="extending_actors.html" title="Extending Actors">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../advanced_topics.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../advanced_topics.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="extending_actors.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="phoenix.advanced_topics.porting_from_phoenix_2_0"></a><a class="link" href="porting_from_phoenix_2_0.html" title="Porting from Phoenix 2.0">Porting
      from Phoenix 2.0</a>
</h3></div></div></div>
<p>
        While reading the current documentation you might have noticed that the
        <a class="link" href="../starter_kit.html" title="Starter Kit">Starter Kit</a> didn't change very
        much. This is because a lot of effort was put into being compatible with
        Phoenix 2.0, at least on the outside.
      </p>
<p>
        That being said, the only major difference is the result type deduction protocol.
        The everyday Phoenix-User will encounter this change only when writing <a class="link" href="../reference/modules/function.html" title="Function">Functions</a>.
      </p>
<p>
        To make your function implementations Phoenix compliant again change from
        the old Phoenix result type deduction protocol to the new (standard compliant)
        result type deduction protocol:
      </p>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Phoenix 2.0
                </p>
              </th>
<th>
                <p>
                  Phoenix 3.0
                </p>
              </th>
<th>
                <p>
                  Notes
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  
</p>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">struct</span> <span class="identifier">is_odd_impl</span>
<span class="special">{</span>
	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg</span><span class="special">&gt;</span>
	<span class="keyword">struct</span> <span class="identifier">result</span>
	<span class="special">{</span>
		<span class="keyword">typedef</span> <span class="keyword">bool</span> <span class="identifier">type</span><span class="special">;</span>
	<span class="special">};</span>

	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg</span><span class="special">&gt;</span>
	<span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">Arg</span> <span class="identifier">arg</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">arg</span> <span class="special">%</span> <span class="number">2</span> <span class="special">==</span> <span class="number">1</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="identifier">boost</span><span class="special">::</span><span class="identifier">phoenix</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">is_odd_impl</span><span class="special">&gt;</span> <span class="identifier">is_odd</span> <span class="special">=</span> <span class="identifier">is_odd_impl</span><span class="special">();</span>
</pre>
<p>
                </p>
              </td>
<td>
                <p>
                  
</p>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">struct</span> <span class="identifier">is_odd_impl</span>
<span class="special">{</span>
	<span class="keyword">typedef</span> <span class="keyword">bool</span> <span class="identifier">result_type</span><span class="special">;</span>

	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg</span><span class="special">&gt;</span>
	<span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">Arg</span> <span class="identifier">arg</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">arg</span> <span class="special">%</span> <span class="number">2</span> <span class="special">==</span> <span class="number">1</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="identifier">boost</span><span class="special">::</span><span class="identifier">phoenix</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">is_odd_impl</span><span class="special">&gt;</span> <span class="identifier">is_odd</span> <span class="special">=</span> <span class="identifier">is_odd_impl</span><span class="special">();</span>
</pre>
<p>
                </p>
              </td>
<td>
                <p>
                  <span class="inlinemediaobject"><img src="../../images/note.png" alt="note"></span> The result_of protocol is particulary easy
                  when you implement a monomorphic function (return type not dependant
                  on the arguments). You then just need a single nested return_type
                  typedef.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  
</p>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">struct</span> <span class="identifier">add_impl</span>
<span class="special">{</span>
	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg1</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Arg2</span><span class="special">&gt;</span>
	<span class="keyword">struct</span> <span class="identifier">result</span>
	<span class="special">{</span>
		<span class="keyword">typedef</span> <span class="identifier">Arg1</span><span class="special">;</span>
	<span class="special">};</span>

	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg1</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Arg2</span><span class="special">&gt;</span>
	<span class="identifier">Arg1</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">Arg1</span> <span class="identifier">arg1</span><span class="special">,</span> <span class="identifier">Arg2</span> <span class="identifier">arg2</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">arg1</span> <span class="special">+</span> <span class="identifier">arg2</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="identifier">boost</span><span class="special">::</span><span class="identifier">phoenix</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">add_impl</span><span class="special">&gt;</span> <span class="identifier">add</span> <span class="special">=</span> <span class="identifier">add_impl</span><span class="special">();</span>
</pre>
<p>
                </p>
              </td>
<td>
                <p>
                  
</p>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">struct</span> <span class="identifier">add_impl</span>
<span class="special">{</span>
	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Sig</span><span class="special">&gt;</span>
	<span class="keyword">struct</span> <span class="identifier">result</span><span class="special">;</span>

	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">This</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Arg1</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Arg2</span><span class="special">&gt;</span>
	<span class="keyword">struct</span> <span class="identifier">result</span><span class="special">&lt;</span><span class="identifier">This</span><span class="special">(</span><span class="identifier">Arg1</span><span class="special">,</span> <span class="identifier">Arg2</span><span class="special">)&gt;</span>
		<span class="special">:</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">remove_reference</span><span class="special">&lt;</span><span class="identifier">Arg1</span><span class="special">&gt;</span> <span class="special">{};</span>

	<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">Arg1</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Arg2</span><span class="special">&gt;</span>
	<span class="keyword">typename</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">remove_reference</span><span class="special">&lt;</span><span class="identifier">Arg1</span><span class="special">&gt;::</span><span class="identifier">type</span>
	<span class="keyword">operator</span><span class="special">()(</span><span class="identifier">Arg1</span> <span class="identifier">arg1</span><span class="special">,</span> <span class="identifier">Arg2</span> <span class="identifier">arg2</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">arg1</span> <span class="special">+</span> <span class="identifier">arg2</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="identifier">boost</span><span class="special">::</span><span class="identifier">phoenix</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">add_impl</span><span class="special">&gt;</span> <span class="identifier">add</span> <span class="special">=</span> <span class="identifier">add_impl</span><span class="special">();</span>
</pre>
<p>
                </p>
              </td>
<td>
                <p>
                  <span class="inlinemediaobject"><img src="../../images/alert.png" alt="alert"></span> When dealing with polymorphic functions the
                  template arguments can be any type including cv-qualifiers and
                  references. For that reason, the calculated result type need to
                  remove the reference whenever appropriate!
                </p>
              </td>
</tr>
</tbody>
</table></div>
<div class="sidebar">
<p class="title"><b></b></p>
<p>
        <span class="inlinemediaobject"><img src="../../images/tip.png" alt="tip"></span> There is no general guideline for porting code which
        relies on the internals of Phoenix 2.0. If you plan on porting your Phoenix
        2.0 extensions please refer to the next sections.
      </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2002-2005, 2010 Joel de Guzman, Dan Marsden, Thomas Heller<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../advanced_topics.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../advanced_topics.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="extending_actors.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
