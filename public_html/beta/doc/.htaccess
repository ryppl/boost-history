RewriteEngine On
RewriteBase /doc

# Redirect to the canonical URL.
# TODO: I think this is wrong.

# RewriteCond %{HTTP_HOST} ^boost\.org [NC]
# RewriteRule ^.*$ http://www\.boost\.org%{REQUEST_URI} [R=301]

RewriteRule ^html(/.*)?$ libs/release/doc/html$1 [R]

# Always serve up the latest css/image files in doc/html and doc/src.
RewriteRule ^libs/[^/]*/doc/(?:html|src)/(.*\.css)$ libs/common/doc/src/$1 [L]
RewriteRule ^libs/[^/]*/doc/(?:html|src)/images/([^/]*)$ libs/common/doc/src/images/$1 [L]

# Serve some other static files directly from archive
# Requires an appropriate soft link.
# RewriteCond %{DOCUMENT_ROOT}/doc/archives -l
RewriteCond %{DOCUMENT_ROOT}/doc/archives/boost_$1 -f
RewriteRule ^libs/([0-9_]+/.*\.(?:png|gif|jpg|jpeg|jpe|css|js|pdf|dtd))$ archives/boost_$1 [L,NC]

# Redirect from symbolic names to current versions.
RewriteRule ^libs/release(/.*)?$ libs/1_44_0$1 [R]
RewriteRule ^libs/development(/.*)?$ libs/1_44_0$1 [R]

#~  # In case we don't get a file looking URI we send it to the index.html file.
#~  # - With some exceptions.
RewriteCond %{REQUEST_URI} !/(Jamroot|Jamfile|ChangeLog)$
RewriteRule ^libs/([0-9_]+)/([^.]*[^./])/?$ libs/$1/$2/index.html [R]

# Rewrite specific versions to the dynamic handlers.
RewriteRule ^libs/([0-9_]+)/?$ libraries.php/$1 [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^libs/([0-9_]+)/(.+)$ display_libs.php/boost_$1/$2 [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^libs/?(.*)$ libraries.php$1 [L]

# Handling of tool documentation.
RewriteRule ^tools(\.html)?/jam/?$ tools/jam/index.html [R]
RewriteRule ^tools(\.html)?/jam/(.*) display_jam.php/boost-jam-3.1.18/$2 [L]
RewriteRule ^tools(\.html)?/build/?$ tools/build/index.html [R]
RewriteRule ^tools(\.html)?/build/(.*) display_build.php/boost-build/boost-build/$2 [L]
RewriteRule ^tools(\.html)?/(.*) libs/release/tools/$2 [R]
