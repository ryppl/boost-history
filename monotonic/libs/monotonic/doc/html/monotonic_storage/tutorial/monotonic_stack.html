<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Monotonic Stack</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<link rel="home" href="../../index.html" title="Monotonic Storage 0.3">
<link rel="up" href="../tutorial.html" title="Tutorial">
<link rel="prev" href="using_regions.html" title="Using Regions">
<link rel="next" href="../containers.html" title="Containers">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="using_regions.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="../containers.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" title="Monotonic Stack">
<div class="titlepage"><div><div><h3 class="title">
<a name="monotonic_storage.tutorial.monotonic_stack"></a><a class="link" href="monotonic_stack.html" title="Monotonic Stack">Monotonic
      Stack</a>
</h3></div></div></div>
<p>
        While monotonic allocators use monotonic storage, we can also use this storage
        directly and wherever we want efficient resource management.
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
    <span class="comment">// define local storage of 4k on the stack.
</span>    <span class="comment">// allocations will use the heap after the inline stack-based storage
</span>    <span class="comment">// has been exhausted.
</span>    <span class="keyword">typedef</span> <span class="identifier">monotonic</span><span class="special">::</span><span class="identifier">stack</span><span class="special">&lt;</span><span class="number">4</span><span class="special">*</span><span class="number">1024</span><span class="special">&gt;</span> <span class="identifier">Stack</span><span class="special">;</span>
    <span class="identifier">Stack</span> <span class="identifier">stack</span><span class="special">;</span>
    <span class="special">{</span>
        <span class="keyword">int</span> <span class="special">&amp;</span><span class="identifier">num</span> <span class="special">=</span> <span class="identifier">stack</span><span class="special">.</span><span class="identifier">push</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;();</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&amp;</span><span class="identifier">str</span> <span class="special">=</span> <span class="identifier">stack</span><span class="special">.</span><span class="identifier">push</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;(</span><span class="string">"foo"</span><span class="special">);</span>        <span class="comment">// objects are created in-place on the stack
</span>        <span class="identifier">boost</span><span class="special">::</span><span class="identifier">array</span><span class="special">&lt;</span><span class="keyword">char</span><span class="special">,</span> <span class="number">1000</span><span class="special">&gt;</span> <span class="special">&amp;</span><span class="identifier">bytes</span> <span class="special">=</span> <span class="identifier">stack</span><span class="special">.</span><span class="identifier">push_array</span><span class="special">&lt;</span><span class="keyword">char</span><span class="special">,</span> <span class="number">1000</span><span class="special">&gt;();</span>
        
        <span class="comment">// use bytes
</span>        <span class="identifier">std</span><span class="special">::</span><span class="identifier">generate_n</span><span class="special">(</span><span class="identifier">bytes</span><span class="special">.</span><span class="identifier">begin</span><span class="special">(),</span> <span class="number">1000</span><span class="special">,</span> <span class="identifier">rand</span><span class="special">);</span>
        
        <span class="comment">// pop them off the stack
</span>        <span class="identifier">stack</span><span class="special">.</span><span class="identifier">pop</span><span class="special">();</span>
        
        <span class="keyword">float</span> <span class="special">&amp;</span><span class="identifier">num2</span> <span class="special">=</span> <span class="identifier">stack</span><span class="special">.</span><span class="identifier">push</span><span class="special">&lt;</span><span class="keyword">float</span><span class="special">&gt;();</span>
        <span class="identifier">stack</span><span class="special">.</span><span class="identifier">pop</span><span class="special">();</span>
        
        <span class="identifier">assert</span><span class="special">(</span><span class="identifier">stack</span><span class="special">.</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">2</span><span class="special">);</span>
        
        <span class="identifier">BOOST_FOREACH</span><span class="special">(</span><span class="identifier">Stack</span><span class="special">::</span><span class="identifier">value_type</span> <span class="keyword">const</span> <span class="special">&amp;</span><span class="identifier">elem</span><span class="special">,</span> <span class="identifier">stack</span><span class="special">)</span>
        <span class="special">{</span>
            <span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">elem</span><span class="special">.</span><span class="identifier">get_type</span><span class="special">().</span><span class="identifier">name</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
        <span class="special">}</span>
        
        <span class="identifier">DoSomethingElseWith</span><span class="special">(</span><span class="identifier">stack</span><span class="special">);</span>
        
        <span class="comment">// can copy stacks, but cannot compare them
</span>        <span class="identifier">Stack</span> <span class="identifier">copy</span> <span class="special">=</span> <span class="identifier">stack</span><span class="special">;</span>
    <span class="special">}</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        <code class="computeroutput"><span class="identifier">monotonic</span><span class="special">::</span><span class="identifier">stack</span><span class="special">&lt;&gt;</span></code>
        is just like your very own C++ stack which you can share between objects
        and functions and even across process boundaries, independantly of the underlying
        machine-based stack. They can be copied and compared and iterated over.
      </p>
<p>
        Also unlike the stack, storage will use the heap when its local inline stack-based
        buffer is exhuasted. This makes it ideal for using things like local buffers
        and containers that generally will be small enough to fit onto the stack,
        but with the fallback safety of transparently using the heap to service later
        requests for the cases where that inline buffer is not large enough.
      </p>
<p>
        When a stack goes out of scope, all objects in that stack are automatically
        destroyed.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright © 2009 Christian Schladetsch<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="using_regions.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="../containers.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
