<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Tutorial</title>
<link rel="stylesheet" href="../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;boost.sandbox.numeric.odeint">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;boost.sandbox.numeric.odeint">
<link rel="prev" href="../index.html" title="Chapter&#160;1.&#160;boost.sandbox.numeric.odeint">
<link rel="next" href="tutorial/solar_system.html" title="Solar system">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../index.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="tutorial/solar_system.html"><img src="../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="boost_sandbox_numeric_odeint.tutorial"></a><a class="link" href="tutorial.html" title="Tutorial">Tutorial</a>
</h2></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator">Harmonic
      oscillator</a></span></dt>
<dt><span class="section"><a href="tutorial/solar_system.html">Solar
      system</a></span></dt>
<dt><span class="section"><a href="tutorial/chaotic_systems_and_lyapunov_exponents.html">Chaotic
      systems and Lyapunov exponents</a></span></dt>
<dt><span class="section"><a href="tutorial/stiff_systems.html">Stiff
      systems</a></span></dt>
<dt><span class="section"><a href="tutorial/odeint_in_detail.html">Odeint
      in detail</a></span></dt>
<dt><span class="section"><a href="tutorial/special_topics.html">Special
      topics</a></span></dt>
<dt><span class="section"><a href="tutorial/all_examples.html">All
      examples</a></span></dt>
<dt><span class="section"><a href="tutorial/references.html">References</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator"></a><a class="link" href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator" title="Harmonic oscillator">Harmonic
      oscillator</a>
</h3></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.define_the_ode">Define
        the ODE</a></span></dt>
<dt><span class="section"><a href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.stepper_types">Stepper
        Types</a></span></dt>
<dt><span class="section"><a href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_constant_step_size">Integration
        with Constant Step Size</a></span></dt>
<dt><span class="section"><a href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_adaptive_step_size">Integration
        with Adaptive Step Size</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.define_the_ode"></a><a class="link" href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.define_the_ode" title="Define the ODE">Define
        the ODE</a>
</h4></div></div></div>
<p>
          First of all, you have to specify the datatype that represents a state
          of your system <span class="emphasis"><em>x</em></span>. Mathematically, this usually is
          an n-dimensional vector with real numbers or complex numbers as scalar
          objects. For odeint the most natural way is to use <code class="computeroutput"><span class="identifier">vector</span><span class="special">&lt;</span> <span class="keyword">double</span> <span class="special">&gt;</span></code> or <code class="computeroutput"><span class="identifier">vector</span><span class="special">&lt;</span> <span class="identifier">complex</span><span class="special">&lt;</span> <span class="keyword">double</span> <span class="special">&gt;</span> <span class="special">&gt;</span></code>
          to represent the system state. However, odeint can deal with other container
          types as well, e.g. <code class="computeroutput"><span class="identifier">tr1</span><span class="special">::</span><span class="identifier">array</span><span class="special">&lt;</span> <span class="keyword">double</span> <span class="special">,</span> <span class="identifier">N</span> <span class="special">&gt;</span></code> as long as it is fullfils some requirements
          defined below.
        </p>
<p>
          To integrate a differential equation numerically, one has to define the
          rhs of the equation <span class="emphasis"><em>x' = f(x)</em></span>. In odeint you supply
          this function in terms of an object that implements the ()-operator with
          a certain parameter structure. Hence, the straight forward way would be
          to just define a function, e.g:
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="comment">/* The type of container used to hold the state vector */</span>
<span class="keyword">typedef</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span> <span class="keyword">double</span> <span class="special">&gt;</span> <span class="identifier">state_type</span><span class="special">;</span>

<span class="keyword">const</span> <span class="keyword">double</span> <span class="identifier">gam</span> <span class="special">=</span> <span class="number">0.15</span><span class="special">;</span>

<span class="comment">/* The rhs of x' = f(x) */</span>
<span class="keyword">void</span> <span class="identifier">harmonic_oscillator</span><span class="special">(</span> <span class="keyword">const</span> <span class="identifier">state_type</span> <span class="special">&amp;</span><span class="identifier">x</span> <span class="special">,</span> <span class="identifier">state_type</span> <span class="special">&amp;</span><span class="identifier">dxdt</span> <span class="special">,</span> <span class="keyword">const</span> <span class="keyword">double</span> <span class="identifier">t</span> <span class="special">)</span>
<span class="special">{</span>
    <span class="identifier">dxdt</span><span class="special">[</span><span class="number">0</span><span class="special">]</span> <span class="special">=</span> <span class="identifier">x</span><span class="special">[</span><span class="number">1</span><span class="special">];</span>
    <span class="identifier">dxdt</span><span class="special">[</span><span class="number">1</span><span class="special">]</span> <span class="special">=</span> <span class="special">-</span><span class="identifier">x</span><span class="special">[</span><span class="number">0</span><span class="special">]</span> <span class="special">-</span> <span class="identifier">gam</span><span class="special">*</span><span class="identifier">x</span><span class="special">[</span><span class="number">1</span><span class="special">];</span>
<span class="special">}</span>
</pre>
<p>
        </p>
<p>
          The parameters of the function must follow the example above where <code class="computeroutput"><span class="identifier">x</span></code> is the current state, <code class="computeroutput"><span class="identifier">dxdt</span></code> is the derivative <span class="emphasis"><em>x'</em></span>
          and should be filled by the function with <span class="emphasis"><em>f(x)</em></span> and
          <code class="computeroutput"><span class="identifier">t</span></code> is the current time.
        </p>
<p>
          A more sophisticated approach is to implement the system as a class where
          the rhs function is defined as the ()-operator of the class with the same
          parameter structure as above:
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="comment">/* The rhs of x' = f(x) defined as a class */</span>
<span class="keyword">class</span> <span class="identifier">harm_osc</span> <span class="special">{</span>

    <span class="keyword">double</span> <span class="identifier">m_gam</span><span class="special">;</span>

<span class="keyword">public</span><span class="special">:</span>
    <span class="identifier">harm_osc</span><span class="special">(</span> <span class="keyword">double</span> <span class="identifier">gam</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">m_gam</span><span class="special">(</span><span class="identifier">gam</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">void</span> <span class="keyword">operator</span><span class="special">()</span> <span class="special">(</span> <span class="keyword">const</span> <span class="identifier">state_type</span> <span class="special">&amp;</span><span class="identifier">x</span> <span class="special">,</span> <span class="identifier">state_type</span> <span class="special">&amp;</span><span class="identifier">dxdt</span> <span class="special">,</span> <span class="keyword">const</span> <span class="keyword">double</span> <span class="identifier">t</span> <span class="special">)</span>
    <span class="special">{</span>
        <span class="identifier">dxdt</span><span class="special">[</span><span class="number">0</span><span class="special">]</span> <span class="special">=</span> <span class="identifier">x</span><span class="special">[</span><span class="number">1</span><span class="special">];</span>
        <span class="identifier">dxdt</span><span class="special">[</span><span class="number">1</span><span class="special">]</span> <span class="special">=</span> <span class="special">-</span><span class="identifier">x</span><span class="special">[</span><span class="number">0</span><span class="special">]</span> <span class="special">-</span> <span class="identifier">m_gam</span><span class="special">*</span><span class="identifier">x</span><span class="special">[</span><span class="number">1</span><span class="special">];</span>
    <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
        </p>
<p>
          odeint can deal with instances of such classes instead of pure functions
          which allows for cleaner code.
        </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.stepper_types"></a><a class="link" href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.stepper_types" title="Stepper Types">Stepper
        Types</a>
</h4></div></div></div>
<p>
          Numerical integration works iteratively, that means you start at a state
          <span class="emphasis"><em>x(t)</em></span> and perform a timestep of length <span class="emphasis"><em>dt</em></span>
          to obtain the approximate state <span class="emphasis"><em>x(t+dt)</em></span>. There exist
          many different methods to perform such a timestep each of which has a certain
          order <span class="emphasis"><em>q</em></span>. If the order of a method is <span class="emphasis"><em>q</em></span>
          than it is accurate up to term <span class="emphasis"><em>~dt<sup>q</sup></em></span> that means the
          error in <span class="emphasis"><em>x</em></span> made by such a step is <span class="emphasis"><em>~dt<sup>q+1</sup></em></span>.
          odeint provides several steppers of different orders from which you can
          choose:
        </p>
<div class="table">
<a name="id575777"></a><p class="title"><b>Table&#160;1.2.&#160;Stepper Algorithms</b></p>
<div class="table-contents"><table class="table" summary="Stepper Algorithms">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                  <p>
                    Method
                  </p>
                </th>
<th>
                  <p>
                    Class
                  </p>
                </th>
<th>
                  <p>
                    Order
                  </p>
                </th>
<th>
                  <p>
                    Error Estimation
                  </p>
                </th>
<th>
                  <p>
                    Dense Output
                  </p>
                </th>
<th>
                  <p>
                    Remarks
                  </p>
                </th>
</tr></thead>
<tbody>
<tr>
<td>
                  <p>
                    Explicit Euler
                  </p>
                </td>
<td>
                  <p>
                    explicit_euler
                  </p>
                </td>
<td>
                  <p>
                    1
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    Yes
                  </p>
                </td>
<td>
                  <p>
                    Very simple, only for demonstrating purposes
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Runge-Kutta 4
                  </p>
                </td>
<td>
                  <p>
                    explicit_rkrk4
                  </p>
                </td>
<td>
                  <p>
                    4
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    Good default method
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Runge-Kutta Cash-Karp
                  </p>
                </td>
<td>
                  <p>
                    explicit_error_rk54_ck
                  </p>
                </td>
<td>
                  <p>
                    5
                  </p>
                </td>
<td>
                  <p>
                    Yes (Order 4)
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    ...
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Dormand-Prince 5
                  </p>
                </td>
<td>
                  <p>
                    explicit_error_dopri5
                  </p>
                </td>
<td>
                  <p>
                    5
                  </p>
                </td>
<td>
                  <p>
                    Yes (Order 4)
                  </p>
                </td>
<td>
                  <p>
                    Yes
                  </p>
                </td>
<td>
                  <p>
                    ...
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Implicit Euler
                  </p>
                </td>
<td>
                  <p>
                    implicit_euler
                  </p>
                </td>
<td>
                  <p>
                    1
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    Needs the Jacobian
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Rosenbrock 4
                  </p>
                </td>
<td>
                  <p>
                    rosenbrock4
                  </p>
                </td>
<td>
                  <p>
                    4
                  </p>
                </td>
<td>
                  <p>
                    Yes
                  </p>
                </td>
<td>
                  <p>
                    Yes
                  </p>
                </td>
<td>
                  <p>
                    Good for stiff systems
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    Symplectic Euler
                  </p>
                </td>
<td>
                  <p>
                    symplectic_euler
                  </p>
                </td>
<td>
                  <p>
                    1
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    No
                  </p>
                </td>
<td>
                  <p>
                    Symplectic solver for separable Hamiltonian system
                  </p>
                </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
          Some of steppers in the table above are special: Some need the Jacobian
          of the ODE, others are constructed for special ODE-systems like Hamiltonian
          systems. We will show typical examples and use cases in this tutorial and
          which kind of steppers should be applied.
        </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_constant_step_size"></a><a class="link" href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_constant_step_size" title="Integration with Constant Step Size">Integration
        with Constant Step Size</a>
</h4></div></div></div>
<p>
          The basic stepper just performs one timestep and doesn't give you any information
          about the error that was made (except that you know it is of order <span class="emphasis"><em>q+1</em></span>).
          Such steppers are used with constant step size that should be chosen small
          enough to have reasonable small errors. However, you should apply some
          sort of validity check of your results (such as observing conserved quantities)
          becasue you have no other control of the error. The following example defines
          a basic stepper based on the classical Runge-Kutta scheme of 4th order.
          The declaration of the stepper requires the state type as template parameter.
          The integration can now be done by using the <code class="computeroutput"><span class="identifier">integrate_const</span><span class="special">(</span> <span class="identifier">Stepper</span><span class="special">,</span> <span class="identifier">System</span><span class="special">,</span> <span class="identifier">state</span><span class="special">,</span> <span class="identifier">start_time</span><span class="special">,</span> <span class="identifier">end_time</span><span class="special">,</span> <span class="identifier">step_size</span>
          <span class="special">)</span></code> function from odeint:
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="identifier">explicit_rk4</span><span class="special">&lt;</span> <span class="identifier">state_type</span> <span class="special">&gt;</span> <span class="identifier">stepper</span><span class="special">;</span>
<span class="identifier">integrate_const</span><span class="special">(</span> <span class="identifier">stepper</span> <span class="special">,</span> <span class="identifier">harmonic_oscillator</span> <span class="special">,</span> <span class="identifier">x</span> <span class="special">,</span> <span class="number">0.0</span> <span class="special">,</span> <span class="number">10.0</span> <span class="special">,</span> <span class="number">0.01</span> <span class="special">);</span>
</pre>
<p>
        </p>
<p>
          This call integrates the system defined by <code class="computeroutput"><span class="identifier">harmonic_oscillator</span></code>
          using the RK4 method from <span class="emphasis"><em>t=0</em></span> to <span class="emphasis"><em>10</em></span>
          with a stepsize <span class="emphasis"><em>dt=0.01</em></span> and the initial condition
          given in <code class="computeroutput"><span class="identifier">x</span></code>. The result,
          <span class="emphasis"><em>x(t=10)</em></span> is stored in <code class="computeroutput"><span class="identifier">x</span></code>
          (in-place). Each stepper defines a <code class="computeroutput"><span class="identifier">do_step</span></code>
          method which can used directly. So, you write down the above example as
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="keyword">const</span> <span class="keyword">double</span> <span class="identifier">dt</span> <span class="special">=</span> <span class="number">0.01</span><span class="special">;</span>
<span class="keyword">for</span><span class="special">(</span> <span class="keyword">double</span> <span class="identifier">t</span><span class="special">=</span><span class="number">0.0</span> <span class="special">;</span> <span class="identifier">t</span><span class="special">&lt;</span><span class="number">10.0</span> <span class="special">;</span> <span class="identifier">t</span><span class="special">+=</span> <span class="identifier">dt</span> <span class="special">)</span>
	<span class="identifier">stepper</span><span class="special">.</span><span class="identifier">do_step</span><span class="special">(</span> <span class="identifier">harmonic_oscillator</span> <span class="special">,</span> <span class="identifier">x</span> <span class="special">,</span> <span class="identifier">t</span> <span class="special">,</span> <span class="identifier">dt</span> <span class="special">);</span>
</pre>
<p>
        </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_adaptive_step_size"></a><a class="link" href="tutorial.html#boost_sandbox_numeric_odeint.tutorial.harmonic_oscillator.integration_with_adaptive_step_size" title="Integration with Adaptive Step Size">Integration
        with Adaptive Step Size</a>
</h4></div></div></div>
<p>
          To improve the numerical results and additionally minimize the computational
          effort, the application of a step size control is advisable. Step size
          control is realized via stepper algorithms that additionally provide an
          error estimation of the applied step. Odeint provides a number of such
          <span class="bold"><strong>ErrorSteppers</strong></span> and we will show their usage
          on the example of `explicit_error_rk54_ck? -- a 5th order Runge-Kutta method
          with 4th order error estimation and coefficients introduced by Cash-Karp.
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">explicit_error_rk54_ck</span><span class="special">&lt;</span> <span class="identifier">state_type</span> <span class="special">&gt;</span> <span class="identifier">error_stepper_type</span><span class="special">;</span>
<span class="identifier">error_stepper_type</span> <span class="identifier">rk54</span><span class="special">;</span>
</pre>
<p>
        </p>
<p>
          Given the error stepper, one still needs an instance that checks the error
          and adjusts the step size accordingly. In odeint, this is done by <span class="bold"><strong>ControlledSteppers</strong></span>. The usual way to create a controlled
          stepper is via the <code class="computeroutput"><span class="identifier">make_controlled_stepper_standard</span><span class="special">(</span> <span class="identifier">ErrorStepper</span>
          <span class="special">,</span> <span class="identifier">eps_abs</span>
          <span class="special">,</span> <span class="identifier">eps_rel</span>
          <span class="special">,</span> <span class="identifier">a_x</span>
          <span class="special">,</span> <span class="identifier">a_dxdt</span>
          <span class="special">)</span></code> function that takes an error stepper
          as parameter and four values defining the maximal absolute and relative
          error allowed for one integration step. The standard controlled stepper
          created by this method ensures that the error <span class="emphasis"><em>err</em></span>
          of the solution fulfills <span class="emphasis"><em>err &lt; eps_abs + eps_rel * ( a<sub>x</sub> * |x|
          + a<sub>dxdt</sub> * dt * |dxdt| ) </em></span> by decreasesing the step size. Note,
          that the stepsize is also increased if the error gets too small compared
          to the rhs of the above relation. Now we have everything needed to integrate
          the harmonic oscillator using an adaptive step size method. Similar to
          the case with constant step size above, there exists a <code class="computeroutput"><span class="identifier">integrate_adaptive</span></code>
          function with a similar parameter structure, but it requires the controlled
          stepper create by <code class="computeroutput"><span class="identifier">make_controlled_stepper_standard</span></code>.
        </p>
<p>
          
</p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">controlled_error_stepper</span><span class="special">&lt;</span> <span class="identifier">error_stepper_type</span> <span class="special">&gt;</span> <span class="identifier">controlled_stepper_type</span><span class="special">;</span>
<span class="identifier">controlled_stepper_type</span> <span class="identifier">controlled_stepper</span><span class="special">;</span>
<span class="identifier">integrate_adaptive</span><span class="special">(</span> <span class="identifier">controlled_stepper</span> <span class="special">,</span> <span class="identifier">harmonic_oscillator</span> <span class="special">,</span> <span class="identifier">x</span> <span class="special">,</span> <span class="number">0.0</span> <span class="special">,</span> <span class="number">10.0</span> <span class="special">,</span> <span class="number">0.01</span> <span class="special">);</span>
</pre>
<p>
        </p>
<p>
          As above, this integrates the system defined by <code class="computeroutput"><span class="identifier">harmonic_oscillator</span></code>
          using an adaptive step size method based on the rk5_ck scheme from <span class="emphasis"><em>t=0</em></span>
          to <span class="emphasis"><em>10</em></span> with an initial step size of <span class="emphasis"><em>dt=0.01</em></span>
          (will be adjusted) and the initial condition given in x. The result, [x(t=10)'],
          will also be stored in x (in-place).
        </p>
</div>
<p>
        Some details
      </p>
<p>
        Observers
      </p>
<p>
        Default construction
      </p>
<p>
        The full cpp file for this example can be found here: <a href="../../../examples/harmonic_oscillator.cpp" target="_top">../../examples/harmonic_oscillator.cpp</a>
      </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2009 -2011 Karsten Ahnert and Mario Mulansky<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../index.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="tutorial/solar_system.html"><img src="../images/next.png" alt="Next"></a>
</div>
</body>
</html>
