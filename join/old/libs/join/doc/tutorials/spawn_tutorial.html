<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Join Spawning Thread Tutorial</title>
</head>
<body>
<h2>Join Spawning Thread Tutorial</h2>
<h4 style="font-weight: normal;" class="dtH4">This tutorial shows how
to spawn threads by simply calling an Join asynchronous method. <br>
</h4>
In Join,<span style="font-weight: normal;">
there is no explicit thread creation and synchronization or even no
explicit
task creation and dispatching to executor thread pool. </span>Chords
with only
async&lt;&gt;
methods will implicitly (automatically) create a task for its body and
dispatch it to the thread pool of the executor
associated with the actor. <span style="font-weight: normal;">All
concurrency and
asynchroncy are defined and created by async&lt;&gt; methods and chords.<br>
<br>
</span>
<div style="margin-left: 40px;"><span style="font-weight: normal;"><span
 style="font-weight: bold;">class spawner : public actor {</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">public:<br>
</span></span></div>
First we define an async method for spawning tasks in executor. And
define a chord body method which will run when the async method is
called.<br>
<div style="margin-left: 40px;"><span style="font-weight: normal;"><span
 style="font-weight: bold;">&nbsp; async&lt;void(std::string)&gt; spawn;</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
void run(async_o&lt;void(std::string)&gt; str) {</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;
for(int i=0; i&lt;6; i++) {</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
log1.msg(str.arg1);</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
thread_sleep(1);</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;
}</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
}<br>
</span></span></div>
In contructor, we initialize the parent actor with the
executor. The asynchronous chord bodies of this actor will be
dispatched to the thread pool of this executor to run. And we create a
chord for the above async method and bind it to its chord body. Since
this chord has only async methods, its body will run in a thread from
executor's thread pool.<br>
<div style="margin-left: 40px;"><span style="font-weight: normal;"><span
 style="font-weight: bold;">&nbsp; spawner(executor *e) :
actor(e) {</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;
chord(spawn, &amp;spawner::run);</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
}</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">};</span></span><br
 style="font-weight: bold;">
</div>
In main(), we create the executor with two threads in pool and create
an instance of spawner class. Then we spawn two tasks into pool.<br>
<div style="margin-left: 40px;"><span style="font-weight: normal;"><span
 style="font-weight: bold;">int main(int argc, char **argv) {</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
executor exec(2);</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
spawner sched(&amp;exec.execute);</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
sched.spawn("thread 1");</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
sched.spawn("thread 2");</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
thread_sleep(5);</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
exec.shutdown();</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
log1.msg("...main thread exits...");</span></span><br
 style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">&nbsp;
return 0;</span></span><br style="font-weight: bold;">
<span style="font-weight: normal;"><span style="font-weight: bold;">}</span></span><br>
<span style="font-weight: normal;"></span></div>
<span style="font-weight: normal;"><br>
</span><br>
<div style="font-weight: bold;">
<span style="font-family: monospace;"></span>&nbsp;</div>
</body>
</html>
