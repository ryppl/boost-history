<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Heterogenous Containers</title>
<link rel="stylesheet" href="../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<link rel="home" href="../index.html" title="Cloneable 0.1">
<link rel="up" href="../index.html" title="Cloneable 0.1">
<link rel="prev" href="tutorial.html" title="Tutorial">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../boost.png"></td>
<td align="center"><a href="../../../index.html">Home</a></td>
<td align="center"><a href="../libraries.html">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tutorial.html"><img src="../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../doc/html/images/home.png" alt="Home"></a>
</div>
<div class="section" title="Heterogenous Containers">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="cloneable.heterogenous_containers"></a><a class="link" href="heterogenous_containers.html" title="Heterogenous Containers">Heterogenous Containers</a>
</h2></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.extended_object_hierarhcy">Extended
      Object Hierarhcy</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.container_method_names">Container
      Method Names</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.list">List</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.vector">Vector</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.set">Set</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.map">Map</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.heterogenous_map">Heterogenous
      Map</a></span></dt>
<dt><span class="section"><a href="heterogenous_containers.html#cloneable.heterogenous_containers.hashmap_and_hashset">HashMap
      and HashSet</a></span></dt>
</dl></div>
<p>
      This section of the tutorial presents the first glimpse of the so-called <span class="emphasis"><em>heterogenous
      containers</em></span> provided by the Cloneable library. These are:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><code class="computeroutput"><span class="identifier">list</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">deque</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">chain</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">LinkLength</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">map</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">heterogenous_map</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">set</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">multimap</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">heterogenous_multimap</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">multiset</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">hash_map</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">heterogenous_hash_map</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem"><code class="computeroutput"><span class="identifier">hash_set</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Predicate</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span></code></li>
<li class="listitem">
<code class="computeroutput"><span class="identifier">hash_multimap</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code>.
      </li>
<li class="listitem">
<code class="computeroutput"><span class="identifier">heterogenous_hash_multimap</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code>.
      </li>
<li class="listitem"><code class="computeroutput"><span class="identifier">hash_multiset</span><span class="special">&lt;</span><span class="identifier">Base</span><span class="special">,</span> <span class="identifier">Pred</span><span class="special">,</span> <span class="identifier">Hash</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span></code></li>
</ul></div>
<p>
      All of these containers store pointers to objects. However, they each expose
      their contained objects using value semantics. If this seems similar to <span class="bold"><strong>Boost.PtrContainer</strong></span>, that is not coincidental, as these
      containers are based on a modified implementation of that library.
    </p>
<p>
      You will have noted that each container is specialised over a <code class="computeroutput"><span class="identifier">Base</span></code> type, rather than a concrete derived
      type. This is because they are intended to store base pointers.
    </p>
<p>
      It may be surprising that <code class="computeroutput"><span class="identifier">heterogenous_map</span><span class="special">&lt;&gt;</span></code> takes only one type - the <code class="computeroutput"><span class="identifier">Base</span></code> type - of objects to store, rather than
      the more familiar <span class="emphasis"><em>key</em></span> and <span class="emphasis"><em>mapped</em></span>
      types. This is because a heterogenous map provides an association between objects
      with the same base type.
    </p>
<p>
      All heterogenous containers create objects to be added 'in place', in storage
      created by the containers allocator. As such, to add a new object to a heterogenous
      container, you provide the type and the construction arguments. Allocation
      and construction is dealt with by the container, and, importantly, <span class="emphasis"><em>objects
      are not copied into the container</em></span>:
    </p>
<p>
      <code class="computeroutput"><span class="identifier">container</span><span class="special">.</span></code><span class="emphasis"><em>add_method</em></span><code class="computeroutput"><span class="special">&lt;</span><span class="identifier">Type</span><span class="special">&gt;(</span><span class="identifier">construction</span>
      <span class="identifier">args</span><span class="special">..);</span></code>
    </p>
<p>
      This means, for instance, that you can use non-default-constructable objects
      in heterogenous vectors.
    </p>
<p>
      It also means that you can use objects that do not or cannot have assignment
      defined.
    </p>
<p>
      Basically, as long as you can construct the object at all, you can use it in
      a heterogenous container.
    </p>
<div class="note" title="Note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/html/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        clones are guaranteed to be created using the same allocator as that used
        to make the original objects.
      </p></td></tr>
</table></div>
<p>
      This is why it is important that you overload <code class="computeroutput"><span class="identifier">make_copy</span><span class="special">(</span><span class="identifier">abstract_allocator</span>
      <span class="special">&amp;)</span> <span class="keyword">const</span></code>,
      rather than the <code class="computeroutput"><span class="identifier">make_copy</span><span class="special">()</span>
      <span class="keyword">const</span></code> method that does not take an allocator.
      (<span class="emphasis"><em>Indeed, there is a good case to be made for removing this second
      method from the library completely - CJS</em></span>).
    </p>
<p>
      These containers will be presented in order, with some motivational examples
      which combines them. First, we shall extend our little Animal hierarchy to
      include an age member, and comparison operators.
    </p>
<div class="section" title="Extended Object Hierarhcy">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.extended_object_hierarhcy"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.extended_object_hierarhcy" title="Extended Object Hierarhcy">Extended
      Object Hierarhcy</a>
</h3></div></div></div>
<p>
        This is the definitions we will use in the following examples. First, let's
        look at a slightly extended base type for our Animal hierarchy:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">Animal</span>
<span class="special">{</span>
	<span class="keyword">double</span> <span class="identifier">age</span><span class="special">;</span>
	<span class="identifier">string</span> <span class="identifier">name</span><span class="special">;</span>
	
	<span class="identifier">Animal</span><span class="special">(</span><span class="keyword">double</span> <span class="identifier">years_old</span> <span class="special">=</span> <span class="number">0</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">age</span><span class="special">(</span><span class="identifier">years_old</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>
	<span class="identifier">Animal</span><span class="special">(</span><span class="identifier">string</span> <span class="identifier">n</span><span class="special">,</span> <span class="keyword">double</span> <span class="identifier">years_old</span> <span class="special">=</span> <span class="number">0</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">age</span><span class="special">(</span><span class="identifier">years_old</span><span class="special">),</span> <span class="identifier">name</span><span class="special">(</span><span class="identifier">n</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>
	
	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">==(</span><span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">left</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">right</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">age</span> <span class="special">==</span> <span class="identifier">right</span><span class="special">.</span><span class="identifier">age</span><span class="special">;</span>
	<span class="special">}</span>
	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">&lt;(</span><span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">left</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">right</span><span class="special">)</span> <span class="keyword">const</span>
	<span class="special">{</span>
		<span class="keyword">return</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">age</span> <span class="special">&lt;</span> <span class="identifier">right</span><span class="special">.</span><span class="identifier">age</span><span class="special">;</span>
	<span class="special">}</span>
	<span class="keyword">struct</span> <span class="identifier">CompareNames</span>
	<span class="special">{</span>
		<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">&lt;(</span><span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">left</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">Animal</span> <span class="special">&amp;</span><span class="identifier">right</span><span class="special">)</span> <span class="keyword">const</span>
		<span class="special">{</span>
			<span class="keyword">return</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">name</span> <span class="special">&lt;</span> <span class="identifier">right</span><span class="special">.</span><span class="identifier">name</span><span class="special">;</span>
		<span class="special">}</span>
	<span class="special">};</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        This is just a little more elaborate than the previous example hierarchy
        we used earlier in the tutorial. We have added an <code class="computeroutput"><span class="identifier">age</span></code>
        field for all animals, indicating how old it is in years. Animals have relational
        operators for testing equivalence and sorting. Another functor named <code class="computeroutput"><span class="identifier">CompareNames</span></code> is provided, which sorts by
        the name field of animals rather than age.
      </p>
<p>
        You are aware that getting your base class right is very important to the
        strength and efficacy of the hierarchy as a whole. At a minimum, you must
        of course use a virtual destructor. Getting the comparison operators right
        is very important as well, but of course we can always add more sorting predicates
        such as <code class="computeroutput"><span class="identifier">CompareNames</span></code> as needed.
      </p>
<p>
        What we would like to avoid is having a so-called <span class="emphasis"><em>fat interface</em></span>
        as the base class, which has a lot of extra information that is only relevant
        to one or more derived types. Some of these issues can be addressed with
        further use of interfaces and virtual methods to obtain sorting criteria.
      </p>
<p>
        A full discussion on object-oriented design is beyond the scope of this brief
        tutorial - and I'm sure you're very aware of the issues in any case. Suffice
        to say that you should pay attention to how you design your base types. Always
        use a virtual destructor, try to keep state to a minimum, and bear in mind
        how you will want to compare objects.
      </p>
<p>
        Moving on, we define our derived types:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">Cat</span> <span class="special">:</span> <span class="identifier">cloneable</span><span class="special">::</span><span class="identifier">base</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">,</span> <span class="identifier">Animal</span><span class="special">&gt;</span>
<span class="special">{</span>
	<span class="identifier">Cat</span><span class="special">(</span><span class="identifier">string</span> <span class="identifier">name</span><span class="special">,</span> <span class="keyword">double</span> <span class="identifier">age</span> <span class="special">=</span> <span class="number">10</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">Animal</span><span class="special">(</span><span class="identifier">name</span><span class="special">,</span> <span class="identifier">age</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">struct</span> <span class="identifier">Dog</span> <span class="special">:</span> <span class="identifier">cloneable</span><span class="special">::</span><span class="identifier">base</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">,</span> <span class="identifier">Animal</span><span class="special">&gt;</span>
<span class="special">{</span>
	<span class="identifier">Dog</span><span class="special">(</span><span class="identifier">string</span> <span class="identifier">name</span><span class="special">,</span> <span class="keyword">double</span> <span class="identifier">age</span> <span class="special">=</span> <span class="number">0</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">Animal</span><span class="special">(</span><span class="identifier">name</span><span class="special">,</span> <span class="identifier">age</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">struct</span> <span class="identifier">Labrador</span> <span class="special">:</span> <span class="identifier">Dog</span><span class="special">,</span> <span class="identifier">cloneable</span><span class="special">::</span><span class="identifier">base</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">,</span> <span class="identifier">Animal</span><span class="special">&gt;</span>
<span class="special">{</span>
	<span class="keyword">bool</span> <span class="identifier">is_guide_dog</span><span class="special">;</span>
	<span class="identifier">Labrador</span><span class="special">(</span><span class="identifier">string</span> <span class="identifier">name</span><span class="special">,</span> <span class="keyword">bool</span> <span class="identifier">can_lead</span><span class="special">,</span> <span class="keyword">double</span> <span class="identifier">age</span> <span class="special">=</span> <span class="number">0</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">Dog</span><span class="special">(</span><span class="identifier">name</span><span class="special">,</span> <span class="identifier">age</span><span class="special">),</span> <span class="identifier">is_guide_dog</span><span class="special">(</span><span class="identifier">can_lead</span><span class="special">)</span> <span class="special">{</span> <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        Labradors now have an extra field indicating that a given instance has been
        trained as a guide dog, and each Animal type can be constructed by passing
        its name and age. Note that there are no default constructors for any of
        the Animal types.
      </p>
<p>
        Feel free to return to this page to refresh your memory as we walk through
        some examples that use these definitions.
      </p>
<p>
        First, a preamble on names and semantics.
      </p>
</div>
<div class="section" title="Container Method Names">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.container_method_names"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.container_method_names" title="Container Method Names">Container
      Method Names</a>
</h3></div></div></div>
<p>
        To add an element of type <code class="computeroutput"><span class="identifier">Ty</span></code>
        to any heterogenous container such as a <code class="computeroutput"><span class="identifier">list</span></code>,
        <code class="computeroutput"><span class="identifier">vector</span></code> or <code class="computeroutput"><span class="identifier">set</span></code>
        we use the following syntax:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="identifier">container</span><span class="special">.</span><span class="identifier">add_method_name</span><span class="special">&lt;</span><span class="identifier">Ty</span><span class="special">&gt;(</span><span class="identifier">a0</span><span class="special">,</span> <span class="identifier">a1</span><span class="special">,...,</span> <span class="identifier">an</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        Specifically, we do not directly add an object to a heterogenous container.
        Rather, we specify the type of thing to add, and provide any construction
        arguments. This is true as well for specifying objects to search for in associative
        containers:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="identifier">container</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Ty</span><span class="special">&gt;(</span><span class="identifier">a0</span><span class="special">,</span> <span class="identifier">a1</span><span class="special">,...,</span> <span class="identifier">an</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        This creates a new object of type <code class="computeroutput"><span class="identifier">Ty</span></code>,
        constructed with the provided arguments, searches for it in the container,
        then destroys it. This means that you can store, and search for objects that
        are not default constructable and/or do not have an assignment operator.
        But, I'm getting a little ahead of ourselves here - more on associative containers
        later.
      </p>
<div class="blockquote"><blockquote class="blockquote">
<p>
          </p>
<p>
            <span class="bold"><strong><span class="emphasis"><em><span class="quote">&#8220;<span class="quote">Aside: The name for the method
            to add new objects to heterogenous sequence containers has gone from
            being called <code class="computeroutput"><span class="identifier">push_back</span></code>
            to <code class="computeroutput"><span class="identifier">emplace_back</span></code> to <code class="computeroutput"><span class="identifier">push_emplace_back</span></code> and back to <code class="computeroutput"><span class="identifier">push_back</span></code>. Similarly for associative
            containers the names have varied from <code class="computeroutput"><span class="identifier">insert</span></code>
            to <code class="computeroutput"><span class="identifier">emplace</span></code> to <code class="computeroutput"><span class="identifier">emplace_insert</span></code> and back to <code class="computeroutput"><span class="identifier">insert</span></code>. The C++0x containers have emplace
            methods that insert a new object after a given iterator location, by
            passing construction arguments. These are called <code class="computeroutput"><span class="identifier">emplace</span></code>
            methods. This is similar to the way that objects are added to heterogenous
            containers, but not the same. For all heterogenous containers, the process
            is to specify the type of thing and any creation arguments. There is
            no need to specify an iterator, but there is a need to specify the type
            explicitly. This is different to the C++0x containers, which do not require
            the type. For this reason the names have changed and are yet to be settled.
            All suggestions for the names of the methods, or namespaces, are welcome.
            I am sure they'll end up being called something like <code class="computeroutput"><span class="identifier">emplace_back</span></code>
            rather than <code class="computeroutput"><span class="identifier">push_back</span></code>;
            but the difference is that there is no <code class="computeroutput"><span class="identifier">push_back</span></code>
            in a heterogenous container: everything is always emplaced, so this is
            one reason why I've been vacillating over the naming conventions to use</span>&#8221;</span></em></span></strong></span>
          </p>
<p>
          </p>
<p>
            -- CJS
          </p>
<p>
        </p>
</blockquote></div>
<p>
        With this in mind, let's visit the first container: the faithful list.
      </p>
</div>
<div class="section" title="List">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.list"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.list" title="List">List</a>
</h3></div></div></div>
<p>
        The first heterogenous container we'll look at is the <code class="computeroutput"><span class="identifier">list</span></code>.
        It is very much like a standard <code class="computeroutput"><span class="identifier">list</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code>.
        But it is also very different:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">heterogenous</span><span class="special">::</span><span class="identifier">list</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;</span> <span class="identifier">List</span><span class="special">;</span>

<span class="identifier">List</span> <span class="identifier">list</span><span class="special">;</span>
<span class="identifier">list</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">,</span> <span class="number">12</span><span class="special">);</span>
<span class="identifier">list</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">8</span><span class="special">);</span>
<span class="identifier">list</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;(</span><span class="string">"max"</span><span class="special">,</span> <span class="number">14</span><span class="special">);</span>

<span class="identifier">List</span> <span class="identifier">copy</span> <span class="special">=</span> <span class="identifier">list</span><span class="special">;</span>

<span class="keyword">const</span> <span class="identifier">Labrador</span> <span class="special">&amp;</span><span class="identifier">lab</span> <span class="special">=</span> <span class="identifier">list</span><span class="special">.</span><span class="identifier">back_as</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;();</span>
<span class="identifier">assert</span><span class="special">(</span><span class="identifier">lab</span><span class="special">.</span><span class="identifier">name</span> <span class="special">==</span> <span class="string">"max"</span> <span class="special">&amp;&amp;</span> <span class="identifier">lab</span><span class="special">.</span><span class="identifier">age</span> <span class="special">==</span> <span class="number">14</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        The first thing you may notice is the strange way we add new items to a list.
        All heterogenous containers use <span class="emphasis"><em>emplace</em></span> semantics for
        searching for existing objects or adding new objects.
      </p>
<p>
        For now, it will be enough to absorb the <span class="emphasis"><em>emplacement syntax</em></span>
        for adding new elements, and to note that the cloned list called <code class="computeroutput"><span class="identifier">copy</span></code> made a deep copy of the list; the
        underlying base pointers were not just copied - they were cloned.
      </p>
</div>
<div class="section" title="Vector">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.vector"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.vector" title="Vector">Vector</a>
</h3></div></div></div>
<p>
        The vector gets the same treatment as lists, with the same syntax for adding
        new elements, but also some extra methods for random access of specifically
        typed contained objects:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">heterogenous</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;</span> <span class="identifier">Vector</span><span class="special">;</span>
<span class="identifier">Vector</span> <span class="identifier">vector</span><span class="special">;</span>
<span class="identifier">vector</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">);</span>
<span class="identifier">vector</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">);</span>
<span class="identifier">vector</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;(</span><span class="string">"max"</span><span class="special">,</span> <span class="number">14</span><span class="special">);</span>

<span class="identifier">Vector</span> <span class="identifier">copy</span> <span class="special">=</span> <span class="identifier">vector</span><span class="special">;</span>

<span class="identifier">Labrador</span> <span class="special">&amp;</span><span class="identifier">lab</span> <span class="special">=</span> <span class="identifier">vector</span><span class="special">.</span><span class="identifier">as</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;(</span><span class="number">2</span><span class="special">);</span>
<span class="identifier">Dog</span> <span class="special">&amp;</span><span class="identifier">labs_dog</span> <span class="special">=</span> <span class="identifier">vector</span><span class="special">.</span><span class="identifier">as</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="number">2</span><span class="special">);</span>
<span class="identifier">Dog</span> <span class="special">&amp;</span><span class="identifier">spot</span> <span class="special">=</span> <span class="identifier">vector</span><span class="special">.</span><span class="identifier">as</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="number">1</span><span class="special">);</span>

<span class="keyword">const</span> <span class="identifier">Dog</span> <span class="special">*</span><span class="identifier">maybe_dog</span> <span class="special">=</span> <span class="identifier">vector</span><span class="special">.</span><span class="identifier">cast</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="number">0</span><span class="special">);</span>
</pre>
<p>
      </p>
<p>
        <span class="emphasis"><em><span class="inlinemediaobject"><img src="../images/alert.png" alt="alert"></span> the names here have undergone a number of changes and
        remain in flux. Suggestions welcome!</em></span>
      </p>
<p>
        <code class="computeroutput"><span class="identifier">push_back</span></code> works just like
        with <code class="computeroutput"><span class="identifier">list</span></code> and is not surprising.
        But the <code class="computeroutput"><span class="identifier">as</span></code> and <code class="computeroutput"><span class="identifier">cast</span></code> methods are new.
      </p>
<p>
        <code class="computeroutput"><span class="identifier">vector</span><span class="special">::</span><span class="identifier">as</span></code> is the same as <code class="computeroutput"><span class="identifier">vector</span><span class="special">::</span><span class="identifier">at</span></code> except
        that it requires a type to convert to. <code class="computeroutput"><span class="identifier">at</span></code>
        will return a base reference. <code class="computeroutput"><span class="identifier">as</span></code>
        returns a derived-type reference, or throws <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_cast</span></code>.
      </p>
<p>
        <code class="computeroutput"><span class="identifier">vector</span><span class="special">::</span><span class="identifier">cast</span></code> (<span class="emphasis"><em>another name in need of
        a better name</em></span>) returns a pointer of the given type to the specified
        element, or returns the null pointer if conversion was not possible or ambiguous.
      </p>
<p>
        The other members in <code class="computeroutput"><span class="identifier">vector</span></code>
        are largely what you would expect with no real surprises. See the reference
        for complete details.
      </p>
</div>
<div class="section" title="Set">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.set"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.set" title="Set">Set</a>
</h3></div></div></div>
<p>
        So far we have been intoduced to the two basic heterogenous sequence containers,
        <code class="computeroutput"><span class="identifier">list</span></code> and <code class="computeroutput"><span class="identifier">vector</span></code>.
        The main difference over the standard containers is how you add new objects
        to them, and that they are, well, heterogenous. You can store any type of
        object in them that derives from the base type that you used to define the
        list or vector.
      </p>
<p>
        Things start to get interesting with the associative containers <code class="computeroutput"><span class="identifier">set</span></code> and <code class="computeroutput"><span class="identifier">map</span></code>.
        Here we take a quick look at how we might use a heterogenous set to store
        a collection of animals.
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="keyword">typedef</span> <span class="identifier">heterogenous</span><span class="special">::</span><span class="identifier">set</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;</span> <span class="identifier">Set</span><span class="special">;</span>
	<span class="identifier">Set</span> <span class="identifier">set</span><span class="special">;</span>
	
	<span class="keyword">const</span> <span class="identifier">Cat</span> <span class="special">&amp;</span><span class="identifier">sam</span> <span class="special">=</span> <span class="identifier">set</span><span class="special">.</span><span class="identifier">emplace</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">,</span> <span class="number">1.5</span><span class="special">).</span><span class="identifier">deref</span><span class="special">();</span>
	<span class="keyword">const</span> <span class="identifier">Dog</span> <span class="special">&amp;</span><span class="identifier">spot</span> <span class="special">=</span> <span class="identifier">set</span><span class="special">.</span><span class="identifier">emplace</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">3</span><span class="special">).</span><span class="identifier">deref</span><span class="special">();</span>
	<span class="keyword">const</span> <span class="identifier">Labrador</span> <span class="special">&amp;</span><span class="identifier">max</span> <span class="special">=</span> <span class="identifier">set</span><span class="special">.</span><span class="identifier">emplace</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;(</span><span class="string">"max"</span><span class="special">,</span> <span class="number">14</span><span class="special">).</span><span class="identifier">deref</span><span class="special">();</span>

	<span class="identifier">Set</span> <span class="identifier">copy</span> <span class="special">=</span> <span class="identifier">set</span><span class="special">;</span>

	<span class="identifier">Set</span><span class="special">::</span><span class="identifier">iterator</span> <span class="identifier">dog</span> <span class="special">=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="number">14</span><span class="special">);</span>		<span class="comment">// find a dog aged 14
</span>	<span class="identifier">Set</span><span class="special">::</span><span class="identifier">iterator</span> <span class="identifier">any</span> <span class="special">=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;(</span><span class="number">1.5</span><span class="special">);</span>	<span class="comment">// find any animal aged 1.5
</span>	<span class="identifier">Set</span><span class="special">::</span><span class="identifier">iterator</span> <span class="identifier">cat</span> <span class="special">=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="number">3</span><span class="special">);</span>		<span class="comment">// find a cat aged 3
</span>
	<span class="identifier">assert</span><span class="special">(&amp;*</span><span class="identifier">dog</span> <span class="special">==</span> <span class="special">&amp;</span><span class="identifier">max</span><span class="special">);</span>
	<span class="identifier">assert</span><span class="special">(&amp;*</span><span class="identifier">any</span> <span class="special">==</span> <span class="special">&amp;</span><span class="identifier">sam</span><span class="special">);</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">cat</span> <span class="special">==</span> <span class="identifier">set</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	
	<span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        TODO
      </p>
</div>
<div class="section" title="Map">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.map"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.map" title="Map">Map</a>
</h3></div></div></div>
<p>
        TODO
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="keyword">typedef</span> <span class="identifier">map</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">Animal</span><span class="special">&gt;</span> <span class="identifier">Map</span><span class="special">;</span>
	<span class="identifier">Map</span> <span class="identifier">map</span><span class="special">;</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">insert</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="number">1</span><span class="special">,</span> <span class="string">"sam"</span><span class="special">,</span> <span class="number">6</span><span class="special">);</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">insert</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="string">"spot"</span><span class="special">,</span> <span class="number">6</span><span class="special">);</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">insert</span><span class="special">&lt;</span><span class="identifier">Lab</span><span class="special">&gt;(</span><span class="number">3</span><span class="special">,</span> <span class="string">"max"</span><span class="special">,</span> <span class="number">6</span><span class="special">);</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        TODO
      </p>
</div>
<div class="section" title="Heterogenous Map">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.heterogenous_map"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.heterogenous_map" title="Heterogenous Map">Heterogenous
      Map</a>
</h3></div></div></div>
<p>
        And also a map of Cloneable to Cloneable:
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="keyword">typedef</span> <span class="identifier">heterogenous_map</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;</span> <span class="identifier">Map</span><span class="special">;</span>
	<span class="identifier">Map</span> <span class="identifier">map</span><span class="special">;</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">key</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">12</span><span class="special">).</span><span class="identifier">value</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"rover"</span><span class="special">,</span> <span class="number">8</span><span class="special">);</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">key</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">,</span> <span class="number">6</span><span class="special">).</span><span class="identifier">value</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sooty"</span><span class="special">,</span> <span class="number">10</span><span class="special">);</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">key</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"fluffy"</span><span class="special">,</span> <span class="number">10</span><span class="special">).</span><span class="identifier">value</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"tigger"</span><span class="special">,</span> <span class="number">14</span><span class="special">);</span>
	<span class="identifier">map</span><span class="special">.</span><span class="identifier">key</span><span class="special">&lt;</span><span class="identifier">Labrador</span><span class="special">&gt;(</span><span class="string">"max"</span><span class="special">,</span> <span class="number">12</span><span class="special">).</span><span class="identifier">value</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sooty"</span><span class="special">,</span> <span class="number">3</span><span class="special">);</span>
	
	<span class="comment">// make a deep copy of both the keys and values in the map
</span>	<span class="identifier">Map</span> <span class="identifier">copy</span> <span class="special">=</span> <span class="identifier">map</span><span class="special">;</span>
	
	<span class="comment">// can search for any type of animal
</span>	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">12</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Animal</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">,</span> <span class="number">6</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	
	<span class="comment">// or, search for specific animal instances
</span>	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">12</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"spot"</span><span class="special">,</span> <span class="number">12</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Cat</span><span class="special">&gt;(</span><span class="string">"sam"</span><span class="special">,</span> <span class="number">6</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"max"</span><span class="special">,</span> <span class="number">12</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	<span class="identifier">assert</span><span class="special">(</span><span class="identifier">copy</span><span class="special">.</span><span class="identifier">find</span><span class="special">&lt;</span><span class="identifier">Dog</span><span class="special">&gt;(</span><span class="string">"fluffy"</span><span class="special">,</span> <span class="number">10</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">copy</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>
	
	<span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        TODO
      </p>
</div>
<div class="section" title="HashMap and HashSet">
<div class="titlepage"><div><div><h3 class="title">
<a name="cloneable.heterogenous_containers.hashmap_and_hashset"></a><a class="link" href="heterogenous_containers.html#cloneable.heterogenous_containers.hashmap_and_hashset" title="HashMap and HashSet">HashMap
      and HashSet</a>
</h3></div></div></div>
<p>
        These share the same interface as <code class="computeroutput"><span class="identifier">map</span></code>
        and <code class="computeroutput"><span class="identifier">set</span></code>, but are based on
        hash tables rather than a tree.
      </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright  2009 Christian Schladetsch<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tutorial.html"><img src="../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../doc/html/images/home.png" alt="Home"></a>
</div>
</body>
</html>
